sap.ui.define(["nrg/base/view/BaseController","sap/ui/model/Filter","sap/ui/model/FilterOperator"],function(a,b,c){"use strict";var d=a.extend("nrg.module.dashboard.view.Tools");return d.prototype.onInit=function(){},d.prototype.onBeforeRendering=function(){var a=this.getOwnerComponent().getCcuxRouteManager().getCurrentRouteInfo();this._bpNum=a.parameters.bpNum,this._caNum=a.parameters.caNum,this._coNum=a.parameters.coNum,this.getView().setModel(this.getOwnerComponent().getModel("comp-dashboard-svcodr"),"oODataSvc"),this.getView().setModel(new sap.ui.model.json.JSONModel,"oReconnectInfo")},d.prototype._formatPositiveX=function(a){return"X"===a||"x"===a?!0:!1},d.prototype._formatNegativeX=function(a){return"X"===a||"x"===a?!1:!0},d.prototype._formatEmergencyReco=function(a){return"E"===a||"e"===a?!0:!1},d.prototype._formatStandardReco=function(a){return"S"===a||"s"===a?!0:!1},d.prototype._onReconnectionClick=function(){this._oReconnectPopup||(this._oReconnectPopup=ute.ui.main.Popup.create({content:sap.ui.xmlfragment(this.getView().sId,"nrg.module.dashboard.view.Reconnect",this),title:"RECONNETION"}),this._oReconnectPopup.addStyleClass("nrgDashboard-reconnectionPopup"),this.getView().addDependent(this._oReconnectPopup)),this._checkReconnectElgi()},d.prototype._onStandardRecoSelected=function(){var a=this.getView().getModel("oReconnectInfo");a.oData.results.length>0&&a.setProperty("/results/0/RecoType","S")},d.prototype._onEmergencyRecoSelected=function(){var a=this.getView().getModel("oReconnectInfo");a.oData.results.length>0&&a.setProperty("/results/0/RecoType","E")},d.prototype._onMtrAcsYesSelected=function(){var a=this.getView().getModel("oReconnectInfo");a.oData.results.length>0&&a.setProperty("/results/0/AccMeter","X")},d.prototype._onMtrAcsNoSelected=function(){var a=this.getView().getModel("oReconnectInfo");a.oData.results.length>0&&a.setProperty("/results/0/AccMeter","")},d.prototype._onReconnectClicked=function(){this._confirmReconnectInput()},d.prototype._onReconnectCancelClicked=function(){this._oReconnectPopup.close()},d.prototype._confirmReconnectInput=function(){var a=this.getView().getModel("oReconnectInfo");a.getProperty("/results/0/ReqName")?a.getProperty("/results/0/ReqNumber")?a.getProperty("/results/0/AccMeter")||a.getProperty("/results/0/AccComment")?this._confirmMeterAccess():ute.ui.main.Popup.Alert({title:"Reconnection -- Confirm",message:"Please input meter access comment."}):ute.ui.main.Popup.Alert({title:"Reconnection -- Confirm",message:"Please input requestor's number."}):ute.ui.main.Popup.Alert({title:"Reconnection -- Confirm",message:"Please input requestor's name."})},d.prototype._confirmMeterAccess=function(){ute.ui.main.Popup.Confirm({title:"Reconnection -- Confirm",message:"Have you confirmed the meter's accessibility?",callback:function(a){"Yes"===a&&this._confirmPowerOnExpect()}.bind(this)})},d.prototype._confirmPowerOnExpect=function(){ute.ui.main.Popup.Confirm({title:"Reconnection -- Confirm",message:"Please confirm that you have communicated the Power-on expectations to the customer.",callback:function(a){"Yes"===a&&this._updateRecconectInfo()}})},d.prototype._checkReconnectElgi=function(){var a,b,c=this.getView().getModel("oODataSvc");a="/RecoEligS('"+this._caNum+"')",b={success:function(a){return a.RElig?void(this._oReconnectPopup&&(this._oReconnectPopup.open(),this._retrReconnectInfo())):(ute.ui.main.Popup.Alert({title:"Reconnection",message:a.Message}),!1)}.bind(this),error:function(){return ute.ui.main.Popup.Alert({title:"Reconnection",message:"Connection error, reconnection eligible call failed."}),!1}.bind(this)},c&&c.read(a,b)},d.prototype._retrReconnectInfo=function(){var a,d,e=[],f=this.getView().getModel("oODataSvc");e.push(new b({path:"PartnerID",operator:c.EQ,value1:this._bpNum})),e.push(new b({path:"BuagID",operator:c.EQ,value1:this._caNum})),a="/Reconnects(PartnerID='"+this._bpNum+"',BuagID='"+this._caNum+"')",d={filters:e,success:function(a){a&&this.getView().getModel("oReconnectInfo").setData(a)}.bind(this),error:function(){}.bind(this)},f&&f.read(a,d)},d.prototype._updateRecconectInfo=function(){var a,b,c,d=this.getView().getModel("oODataSvc"),e=this.getView().getModel("oReconnectInfo");a="/Reconnects",b={merge:!1,success:function(a){a&&(c="Reconnect Notification "+a.RecoNumber+" created for contract "+a.VERTRAG,ute.ui.main.Popup.Alert({title:"Reconnection",message:c}))}.bind(this),error:function(){ute.ui.main.Popup.Alert({title:"Reconnection",message:"Recoonection Service Order Request Failed"})}.bind(this)},d&&d.create(a,e.getProperty("/results/0/"),b)},d});