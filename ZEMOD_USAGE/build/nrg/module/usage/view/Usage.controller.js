sap.ui.define(["nrg/base/view/BaseController","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/ui/model/json/JSONModel"],function(a,b,c,d){"use strict";var e=a.extend("nrg.module.usage.view.Usage");return e.prototype.onInit=function(){},e.prototype.onAfterRendering=function(){this.getOwnerComponent().getCcuxApp().updateFooter(this._sBP,this._sCA,this._sContract)},e.prototype.onBeforeRendering=function(){var a,b,c,e,f,g,h=this.getView().byId("idnrgUsgServiceAdd-DropDown"),i=this.getView().byId("idnrgUsgServiceAdd-DropDownItem"),j=this.getOwnerComponent().getCcuxRouteManager().getCurrentRouteInfo(),k=this,l=this.getView().byId("idnrgUsgTable-Rows"),m=this.getView().byId("idnrgUsgRow-Infoline"),n=this.getView().byId("idnrgUsg-Graph-chart"),o=this.getView().byId("idnrgUsg-Graph-NoData"),p=this.getView().byId("idnrgUsgNoData").clone(),q=this.getView().byId("idnrgUsgRadioweekly");q.setChecked(!0),this._SelectedInfoLines=[],k._oGraphModel=new d,k.getOwnerComponent().getCcuxApp().setOccupied(!0),this._sContract=j.parameters.coNum,this._sBP=j.parameters.bpNum,this._sCA=j.parameters.caNum,this._sType=j.parameters.typeV,c=["CA"],e=[this._sCA],f=this._createSearchFilterObject(c,e),g=function(){var b,c,d,e,f=h.getContent(),i="/UsageS",j=l.getBinding("content");e=function(a){var b=h.getBinding("content");o.setVisible(!1),k._oGraphModel.setData(k.convertEFLJson(a.mParameters.data.results.reverse())),n.setDataModel(k._oGraphModel),b&&b.detachDataReceived(e)},f&&f.length>0?(k._sContract&&f.forEach(function(a){var b=a.getBindingContext("comp-usage");parseInt(k._sContract,10)===parseInt(b.getProperty("Contract"),10)&&h.setSelectedKey(a.getKey())}),b=["Contract"],c=[k._sContract],d=k._createSearchFilterObject(b,c),a={model:"comp-usage",path:i,template:m,filters:d,events:{dataReceived:e}},l.bindAggregation("content",a)):l&&(l.removeAllContent(),l.addContent(p)),k.getOwnerComponent().getCcuxApp().setOccupied(!1),j&&j.detachDataReceived(g)},b="/SrvAddrS",a={model:"comp-usage",path:b,template:i,filters:f,events:{dataReceived:g}},h.bindAggregation("content",a)},e.prototype._createSearchFilterObject=function(a,d){var e,f=[];for(e=0;e<a.length;e+=1)f.push(new b(a[e],c.EQ,d[e],""));return f},e.prototype.onExpandType=function(){var a=this;this._SelectedInfoLines.forEach(function(b){a._bindInfoLine(b)})},e.prototype.expandInfoline=function(a){var b,c,d=a.getSource().getParent();this.getOwnerComponent().getCcuxApp().setOccupied(!0),d.setExpanded(!d.getExpanded()),b=this._SelectedInfoLines.indexOf(d),c=d.getExpanded()?0>b&&this._SelectedInfoLines.push(d):b>-1&&this._SelectedInfoLines.splice(b,1),d.getExpanded()?this._bindInfoLine(d):(d.removeStyleClass("nrgUsgTable-InfolineSelected"),this.getOwnerComponent().getCcuxApp().setOccupied(!1))},e.prototype._bindInfoLine=function(a){var b,c,d,e,f,g,h,i,j=this.getView().byId("idnrgUsgRadioweekly"),k=this.getView().byId("idnrgUsgTable-insideTmpl"),l=this,m=this.getView().byId("idnrgUsgNoData").clone();b=j&&j.getChecked()?"/WeeklyUsageS":"/DailyUsageS",a.addStyleClass("nrgUsgTable-InfolineSelected"),c=function(){var a=d.getContent(),b=d.getBinding("content");a&&0===a.length&&d.addContent(m),l.getOwnerComponent().getCcuxApp().setOccupied(!1),b&&b.detachDataReceived(c)},h=a.getBindingContext("comp-usage"),e=["Contract","PeriodBegin","PeriodEnd"],f=[h.getProperty("Contract"),h.getProperty("PeriodBegin"),h.getProperty("PeriodEnd")],g=this._createSearchFilterObject(e,f),d=a.getContent().pop(),i={model:"comp-usage",path:b,template:k,filters:g,events:{dataReceived:c}},d.bindAggregation("content",i)},e.prototype.backToPage=function(){"C"===this._sType?this.navTo("campaign",{bpNum:this._sBP,caNum:this._sCA,coNum:this._sContract,typeV:"C"}):"H"===this._sType?this.onRateHistory():"B"===this._sType?this.navTo("billing.HighBill",{bpNum:this._sBP,caNum:this._sCA,coNum:this._sContract}):this.navTo("dashboard.VerificationWithCaCo",{bpNum:this._sBP,caNum:this._sCA,coNum:this._sContract})},e.prototype.toggleTable=function(){},e.prototype.toggleGraph=function(){},e.prototype.onBilling=function(){this.navTo("billing.BillingInfo",{bpNum:this._sBP,caNum:this._sCA,coNum:this._sContract})},e.prototype.onRateHistory=function(){this.navTo("campaignhistory",{bpNum:this._sBP,caNum:this._sCA,coNum:this._sContract})},e.prototype.onServiceAdd=function(){var a,b,c,d,e,f,g,h,i="/UsageS",j=this.getView().byId("idnrgUsgTable-Rows"),k=this.getView().byId("idnrgUsgRow-Infoline"),l=this,m=this.getView().byId("idnrgUsgServiceAdd-DropDown"),n=this.getView().byId("idnrgUsg-Graph-NoData"),o=[];this._SelectedInfoLines=[],g=m.getContent(),h=m.getSelectedKey(),g.forEach(function(b){b.getKey()===h&&(a=b.getBindingContext("comp-usage"))}),l._oGraphModel.setData(o),n.setVisible(!0),a&&(b=["Contract"],c=[a.getProperty("Contract")],d=l._createSearchFilterObject(b,c),e=function(a){var b=j.getBinding("content");l._oGraphModel.setData(l.convertEFLJson(a.mParameters.data.results.reverse())),n.setVisible(!1),b&&b.detachDataReceived(e)},f={model:"comp-usage",path:i,template:k,filters:d,events:{dataReceived:e}},j.bindAggregation("content",f))},e.prototype.convertEFLJson=function(a){var b,c,d,e,f=[],g=sap.ui.core.format.DateFormat.getDateInstance({pattern:"MM/dd/yyyy"});for(c=0;c<a.length;c+=1)b=a[c],void 0!==b&&void 0!==b.KwhUsage&&(e=g.format(new Date(b.PeriodEnd.getTime())),f.push({kwhUsage:parseInt(b.KwhUsage,10),meterReadDate:e,avgHighTemp:parseInt(b.HighTemp,10)}));return d={},d.data=f,d},e.prototype.toggleCheckBook=function(){this.navTo("billing.CheckBook",{bpNum:this._sBP,caNum:this._sCA,coNum:this._sContract})},e.prototype.toggleBillWizard=function(){this.navTo("billing.HighBill",{bpNum:this._sBP,caNum:this._sCA,coNum:this._sContract})},e.prototype.onDunningHistory=function(){var a=this.getOwnerComponent().getCcuxWebUiManager();a.notifyWebUi("openIndex",{LINK_ID:"Z_DUNH"})},e.prototype.formatDateColumn=function(a,b,c){var d="";if(b)return d+=b,c&&"D"!==a&&(d+=" - "+c),d},e.prototype.formatESID=function(a,b){var c="";return a&&b&&(c+="[ ESID - "+b+" ] "),c},e.prototype.formatAddress=function(a,b,c,d,e,f){var g="";return a&&(g+=a),b&&(g+=" "+b),c&&(g+=",  "+c),(a||b||c)&&(g+=","),d&&(g+=" "+d+","),e&&(g+=" "+e),f&&(g+=" "+f),g},e});