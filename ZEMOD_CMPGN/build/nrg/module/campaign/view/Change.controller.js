sap.ui.define(["nrg/base/view/BaseController","sap/ui/model/Filter","sap/ui/model/FilterOperator","jquery.sap.global","sap/ui/model/json/JSONModel"],function(a,b,c,d){"use strict";var e=a.extend("nrg.module.campaign.view.Change");return e.prototype.onInit=function(){},e.prototype.onAfterRendering=function(){this.getOwnerComponent().getCcuxApp().updateFooter(this._sBP,this._sCA,this._sContract),this.getOwnerComponent().getCcuxApp().setOccupied(!1)},e.prototype.onBeforeRendering=function(){var a,b,c,e,f,g,h=[],i=this,j=this.getOwnerComponent().getCcuxRouteManager().getCurrentRouteInfo();if(this._i18NModel=this.getOwnerComponent().getModel("comp-i18n-campaign"),this.getOwnerComponent().getCcuxApp().setOccupied(!0),this._sContract=j.parameters.coNum,this._sNewOfferCode=j.parameters.offercodeNum,this._sStartDate=j.parameters.sDV,this._sBP=j.parameters.bpNum,this._sCA=j.parameters.caNum,b="/CpgChgOfferS",this._sDate=j.parameters.sDate,b=b+"(Contract='"+this._sContract+"',OfferCode='"+this._sNewOfferCode+"',StartDate="+this._sDate+")",a=this.getOwnerComponent().getModel("comp-campaign"),e=new sap.ui.model.json.JSONModel,this._bindView(b),f=i.getView().getModel("comp-campaign").getProperty(b+"/EFLs"),void 0!==f&&f.length>0)for(g=0;g<f.length;g+=1)h.push(i.getView().getModel("comp-campaign").getProperty("/"+f[g]));e.setData(i.convertEFLJson(h)),i._oEFLModel=e,c=sap.ui.view({preprocessors:{xml:{models:{tmpl:i._oEFLModel}}},type:sap.ui.core.mvc.ViewType.XML,viewName:"nrg.module.campaign.view.EFLData"}),i.getView().byId("idnrgCamChgPriceT").removeAllAggregation("content"),i.getView().byId("idnrgCamChgPriceT").addContent(c),d.sap.log.info("Odata Read Successfully:::")},e.prototype._bindView=function(a){var b=function(){d.sap.log.info("Data Received:::")};this.getView().bindElement({model:"comp-campaign",path:a,events:{dataReceived:b}})},e.prototype.onAcceptCampaign=function(){this.getView().getBindingContext("comp-campaign").getProperty("OfferCode"),this.getView().getBindingContext("comp-campaign").getProperty("Type");this.navTo("campaignSS",{bpNum:this._sBP,caNum:this._sCA,offercodeNum:this._sNewOfferCode,coNum:this._sContract,sDate:this._sDate})},e.prototype.onDisposition=function(a){var b,c,e,f,g,h,i,j,k,l,m,n,o=this.getOwnerComponent().getModel("comp-campaign"),p=this;this.getOwnerComponent().getCcuxApp().setOccupied(!0),b=a.getSource().getBindingContext("comp-campaign").getPath(),e=o.getContext(b),g=e.getProperty("Campaign"),f=e.getProperty("Brand"),i=e.getProperty("OfferCode"),h=this._sCA,n=e.getProperty("Promo"),j=a.mParameters.selectedKey,k=e.getProperty("PromoRank"),l=e.getProperty("Contract"),m=e.getProperty("Type"),c={method:"POST",urlParameters:{Brand:f,CA:h,CampaignCode:g,Contract:l,DispoCode:j,OfferCode:i,PromoCode:n,PromoRank:k,Type:m},success:function(a){void 0!==a&&"S"===a.Code?(this.getOwnerComponent().getCcuxApp().setOccupied(!1),sap.ui.commons.MessageBox.alert("Disposition process is completed"),this.navTo("campaign",{bpNum:p._sBP,caNum:p._sCA,coNum:p._sContract,typeV:"C"})):(this.getOwnerComponent().getCcuxApp().setOccupied(!1),sap.ui.commons.MessageBox.alert("Disposition process is Failed"),this.navTo("campaignoffers",{bpNum:p._sBP,caNum:p._sCA,coNum:p._sContract,typeV:"P"})),d.sap.log.info("Odata Read Successfully:::"+a.Code)}.bind(this),error:function(){this.getOwnerComponent().getCcuxApp().setOccupied(!1),sap.ui.commons.MessageBox.alert("Disposition process is Failed")}.bind(this)},o.callFunction("/RejectCampaign",c)},e.prototype.backToOverview=function(){this.navTo("campaign",{bpNum:this._sBP,caNum:this._sCA,coNum:this._sContract,typeV:"C"})},e.prototype.convertEFLJson=function(a){var b,c,d,e,f=[],g=[],h=!1,i=[],j=[];for(c=0;c<a.length;c+=1)if(b=a[c],void 0!==b&&void 0!==b.EFLLevel&&void 0!==g){for(d=0;d<g.length;d+=1)if(b.EFLLevel===g[d]){h=!0;break}h?h=!1:(g.push(b.EFLLevel),f.push({EFLLevel:b.EFLLevel}))}for(c=0;c<a.length;c+=1)if(b=a[c],void 0!==b&&void 0!==b.EFLType&&void 0!==j){for(d=0;d<j.length;d+=1)if(b.EFLType===j[d]){h=!0;break}h?h=!1:j.push(b.EFLType)}for(e={},e.results={},e.results.columns=f,e.results.rows=[],d=0;d<j.length;d+=1){for(i=[],c=0;c<a.length;c+=1)b=a[c],void 0!==b&&void 0!==b.EFLLevel&&void 0!==b.EFLType&&b.EFLType===j[d]&&i.push({EFLPrice:b.EFLPrice});e.results.rows.push({cells:i})}return e},e});