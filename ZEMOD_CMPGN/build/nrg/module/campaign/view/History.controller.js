sap.ui.define(["nrg/base/view/BaseController","jquery.sap.global","sap/ui/model/json/JSONModel","sap/ui/model/Filter","sap/ui/model/FilterOperator"],function(a,b,c,d,e){"use strict";var f=a.extend("nrg.module.campaign.view.History");return f.prototype.onInit=function(){},f.prototype.onAfterRendering=function(){this.getOwnerComponent().getCcuxApp().updateFooter(this._sBP,this._sCA,this._sContract)},f.prototype.onBeforeRendering=function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s=this,t=[],u=this.getOwnerComponent().getCcuxRouteManager().getCurrentRouteInfo();this.getOwnerComponent().getCcuxApp().setOccupied(!0),this._i18NModel=this.getOwnerComponent().getModel("comp-i18n-campaign"),this._sContract=u.parameters.coNum,this._sBP=u.parameters.bpNum,this._sCA=u.parameters.caNum,f=["Contract","Type"],g=[this._sContract,"H"],e=this._createSearchFilterObject(f,g),a=this._i18NModel.getProperty("nrgHistorySet"),c=this.getView().byId("idnrgCamHis-table"),d=this.getView().byId("idnrgCamHis-row").clone(),h=this.getView().byId("idnrgCamHisData"),i=this.getView().byId("idnrgCamHisNoData"),n=this.getView().byId("idnrgCamHis-prcCol"),m=this.getView().byId("idnrgCamHis-prcRow"),l=this.getView().byId("idnrgCamHisPriceT"),p=new sap.ui.model.json.JSONModel,j=function(){var b=c.getBinding("rows");if(k=c.getRows(),void 0!==k&&k.length>0){if(a=k[0].getBindingContext("comp-campaign").getPath(),k[0].addStyleClass("nrgCamHis-but-selected"),q=this.getModel("comp-campaign").getProperty(a+"/EFLs"),void 0!==q&&q.length>0)for(r=0;r<q.length;r+=1)t.push(this.getModel("comp-campaign").getProperty("/"+q[r]));if(void 0===t&&0===t.length)return;p.setData(s.convertEFLJson(t)),s._oEFLModel=p,o=new sap.ui.view({preprocessors:{xml:{models:{tmpl:s._oEFLModel}}},type:sap.ui.core.mvc.ViewType.XML,viewName:"nrg.module.campaign.view.EFLData"}),s.getView().byId("idnrgCamHisPriceT").removeAllAggregation("content"),s.getView().byId("idnrgCamHisPriceT").addContent(o),s.getView().bindElement({model:"comp-campaign",path:a})}else h.addStyleClass("nrgCamHis-hide"),i.removeStyleClass("nrgCamHis-hide");s.getOwnerComponent().getCcuxApp().setOccupied(!1),b&&b.detachDataReceived(j)},b={parameters:{expand:"EFLs"},model:"comp-campaign",path:a,template:d,filters:e,events:{dataReceived:j}},c.bindAggregation("rows",b)},f.prototype.onPressed=function(a){var b,c,d,e,f,g,h,i,j,k,l,m=this.getView().byId("idnrgCamHis-table"),n=[];for(e=m.getRows(),b=a.getSource().getParent().findElements(),d=0;d<b.length;d+=1)b[d].hasStyleClass("nrgCamHis-but-selected")&&b[d].removeStyleClass("nrgCamHis-but-selected");if(a.getSource().addStyleClass("nrgCamHis-but-selected"),c=a.getSource().getBindingContext("comp-campaign").getPath(),f=this.getView().byId("idnrgCamHisPriceT"),f.removeAllAggregation("content"),g=this.getView().byId("idnrgCamHis-prcRow"),h=this.getView().byId("idnrgCamHis-prcCol"),this.getView().bindElement({model:"comp-campaign",path:c}),j=new sap.ui.model.json.JSONModel,k=this.getView().getModel("comp-campaign").getProperty(c+"/EFLs"),void 0!==k&&k.length>0)for(l=0;l<k.length;l+=1)n.push(this.getView().getModel("comp-campaign").getProperty("/"+k[l]));j.setData(this.convertEFLJson(n)),i=sap.ui.view({preprocessors:{xml:{models:{tmpl:j}}},type:sap.ui.core.mvc.ViewType.XML,viewName:"nrg.module.campaign.view.EFLData"}),f.addContent(i)},f.prototype.formatTileDate=function(a,b){return a+" - "+b},f.prototype.formatEFLType=function(a){return"EFL@"+a},f.prototype.convertEFLJson=function(a){var b,c,d,e,f=[],g=[],h=!1,i=[],j=[];for(c=0;c<a.length;c+=1)if(b=a[c],void 0!==b&&void 0!==b.EFLLevel&&void 0!==g){for(d=0;d<g.length;d+=1)if(b.EFLLevel===g[d]){h=!0;break}h?h=!1:(g.push(b.EFLLevel),f.push({EFLLevel:b.EFLLevel}))}for(c=0;c<a.length;c+=1)if(b=a[c],void 0!==b&&void 0!==b.EFLType&&void 0!==j){for(d=0;d<j.length;d+=1)if(b.EFLType===j[d]){h=!0;break}h?h=!1:j.push(b.EFLType)}for(e={},e.results={},e.results.columns=f,e.results.rows=[],d=0;d<j.length;d+=1){for(i=[],c=0;c<a.length;c+=1)b=a[c],void 0!==b&&void 0!==b.EFLLevel&&void 0!==b.EFLType&&b.EFLType===j[d]&&i.push({EFLPrice:b.EFLPrice});e.results.rows.push({cells:i})}return e},f.prototype._createSearchFilterObject=function(a,b){var c,f=[];if(void 0!==a)for(c=0;c<a.length;c+=1)f.push(new d(a[c],e.EQ,b[c],""));return f},f.prototype.backToOverview=function(){this.navTo("campaign",{bpNum:this._sBP,caNum:this._sCA,coNum:this._sContract,typeV:"C"})},f.prototype.onAvgUsage=function(){this.navTo("usage",{bpNum:this._sBP,caNum:this._sCA,coNum:this._sContract,typeV:"H"})},f});