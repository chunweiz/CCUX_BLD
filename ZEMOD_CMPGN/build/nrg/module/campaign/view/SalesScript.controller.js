sap.ui.define(["nrg/base/view/BaseController","sap/ui/model/Filter","sap/ui/model/FilterOperator","jquery.sap.global","ute/ui/commons/Dialog","sap/ui/model/json/JSONModel","nrg/module/nnp/view/NNPPopup"],function(a,b,c,d,e,f,g){"use strict";var h=a.extend("nrg.module.campaign.view.SalesScript");return h.prototype.onInit=function(){},h.prototype.onAfterRendering=function(){this.getOwnerComponent().getCcuxApp().updateFooter(this._sBP,this._sCA,this._sContract)},h.prototype.onBeforeRendering=function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n=this.getOwnerComponent().getModel("comp-campaign"),o=this,p=this.getOwnerComponent().getCcuxRouteManager().getCurrentRouteInfo(),q="";l=this.getOwnerComponent().getModel("comp-i18n-campaign"),this.getOwnerComponent().getCcuxApp().setOccupied(!0),this._sContract=p.parameters.coNum,this._sOfferCode=p.parameters.offercodeNum,this._sBP=p.parameters.bpNum,this._sCA=p.parameters.caNum,c=l.getProperty("nrgCpgChangeOffSet"),c="/CpgChgOfferS",this._sDate=p.parameters.sDate,c=c+"(Contract='"+this._sContract+"',OfferCode='"+this._sOfferCode+"',StartDate="+this._sDate+")",m=n.getContext(c),m&&(q=m.getProperty("Promo")),this._bindView(c),c+="/Scripts",f=["Promo","TxtName"],g=[q,"MAND"],b=this._createSearchFilterObject(f,g),d=this.getView().byId("idnrgCamSSDdL"),e=this.getView().byId("idnrgCamSSLngLtIt").clone(),h=this.getView().byId("idCamSSMdTv"),i=function(){j=d.getContent(),void 0!==j&&j.length>0&&(k=j[0].getBindingContext("comp-campaign").getPath(),d.setSelectedKey("EN"),h.bindElement({model:"comp-campaign",path:k})),o.getOwnerComponent().getCcuxApp().setOccupied(!1)},a={model:"comp-campaign",path:c,template:e,filters:b,events:{dataReceived:i}},d.bindAggregation("content",a)},h.prototype._bindView=function(a){this.getView().bindElement({model:"comp-campaign",path:a})},h.prototype._createSearchFilterObject=function(a,d){var e,f=[];for(e=0;e<a.length;e+=1)f.push(new b(a[e],c.EQ,d[e],""));return f},h.prototype.onAccept=function(){var a,b,c=this.getOwnerComponent().getModel("comp-campaign"),e=new g;e.attachEvent("NNPCompleted",this.invokeOverviewScript,this),this.getView().addDependent(e),this._oOverviewDialog=this.getView().byId("idnrgCamOvsDialog"),this.getOwnerComponent().getCcuxApp().setOccupied(!0),a="/NNPS('"+this._sBP+"')",b={success:function(a){e.openNNP(a.BP,a.Email,a.ConsNum),d.sap.log.info("Odata Read Successfully:::")}.bind(this),error:function(){this.getOwnerComponent().getCcuxApp().setOccupied(!0),d.sap.log.info("NNP Error occured")}.bind(this)},c&&c.read(a,b)},h.prototype.invokeOverviewScript=function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n=this,o=this.getView().byId("idnrgCamOvsOvTv"),p=this.getOwnerComponent().getModel("comp-campaign");a="/CpgChgOfferS",a=a+"(Contract='"+this._sContract+"',OfferCode='"+this._sOfferCode+"',StartDate="+this._sDate+")",l=p.getContext(a),l&&(m=l.getProperty("StartDate")),j=["Contract","OfferCode","TxtName","StartDate"],k=[this._sContract,this._sOfferCode,"OVW",m],e=this._createSearchFilterObject(j,k),a="/ScriptS",this._oOverviewDialog.setWidth("750px"),this._oOverviewDialog.setHeight("auto"),this._oOverviewDialog.setTitle("OVERVIEW SCRIPT"),this._oOverviewDialog.setModal(!0),this._oOverviewDialog.addStyleClass("nrgCamOvs-dialog"),b=this.getView().byId("idnrgCamOvsDdL"),f=b.getContent(),c=f[0].clone(),i=function(){f=b.getContent(),void 0!==f&&f.length>0&&(h=f[0].getBindingContext("comp-campaign").getPath(),b.setSelectedKey("EN"),o.bindElement({model:"comp-campaign",path:h})),g.detachDataReceived(i),n.getOwnerComponent().getCcuxApp().setOccupied(!1)},d={model:"comp-campaign",path:a,template:c,filters:e,events:{dataReceived:i}},b.bindAggregation("content",d),g=b.getBinding("content"),this.getView().addDependent(this._oOverviewDialog),this.getOwnerComponent().getCcuxApp().setOccupied(!1),this._oOverviewDialog.open(),this.getOwnerComponent().getCcuxApp().setOccupied(!0)},h.prototype.backToOverview=function(){this.navTo("campaign",{bpNum:this._sBP,caNum:this._sCA,coNum:this._sContract,typeV:"C"})},h.prototype.formatType=function(a){var b=this.getOwnerComponent().getModel("comp-i18n-campaign");return b.getProperty("EN"===a?"nrgCmpSSEN":"nrgCmpSSES")},h.prototype.onMandLngSelected=function(a){var b,c,d=this.getView().byId("idCamSSMdTv"),e=(this.getOwnerComponent().getModel("comp-campaign"),this.getView().byId("idnrgCamSSDdL"));c=a.getSource().getProperty("selectedKey"),e&&e.getContent()&&e.getContent().forEach(function(a){var d=a.getBindingContext("comp-campaign");c===d.getProperty("TxtLang")&&(b=d.getPath())}),b&&d.bindElement({model:"comp-campaign",path:b})},h.prototype.onOvwLngSelected=function(a){var b,c,d=this.getView().byId("idnrgCamOvsOvTv"),e=this.getView().byId("idnrgCamOvsDdL");c=a.getSource().getProperty("selectedKey"),e&&e.getContent()&&e.getContent().forEach(function(a){var d=a.getBindingContext("comp-campaign");c===d.getProperty("TxtLang")&&(b=d.getPath())}),d.bindElement({model:"comp-campaign",path:b})},h.prototype.onRejectionReason=function(){},h.prototype.onOvsAccept=function(){var a,b,c,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u=this;a=this.getOwnerComponent().getModel("comp-campaign"),this.getOwnerComponent().getCcuxApp().setOccupied(!0),i="/CpgChgOfferS(Contract='"+this._sContract+"',OfferCode='"+this._sOfferCode+"',StartDate="+this._sDate+")",j=a.getContext(i),c=j.getProperty("Campaign"),t=j.getProperty("EffectDate"),e=j.getProperty("OfferCode"),f=j.getProperty("OfferTitle"),g=j.getProperty("Promo"),h=j.getProperty("Contract"),k=j.getProperty("PromoRank"),l=j.getProperty("Brand"),n=j.getProperty("Type"),o=this.getOwnerComponent().getModel("comp-campLocal"),p=o.getProperty("/LPCode"),q=o.getProperty("/firstName"),r=o.getProperty("/lastName"),s=o.getProperty("/lprefId"),m=this._sCA,b={method:"POST",urlParameters:{CampaignCode:c,EffectDate:t,LP_Code:p,LP_FirstName:q,LP_LastName:r,LP_RefID:s,OfferCode:e,OfferTitle:f,PromoCode:g,Contract:h,PromoRank:k,Brand:l,CA:m,Type:n,BP:this._sBP,BusinessRole:"ZU_CALL_CTR",ESID:""},success:function(a){var b;void 0!==a&&"S"===a.Code?(u.getOwnerComponent().getCcuxApp().setOccupied(!1),sap.ui.commons.MessageBox.alert("SWAP is completed"),b=u.getOwnerComponent().getCcuxWebUiManager(),b.notifyWebUi("openIndex",{LINK_ID:"ZVASOPTSLN"}),this.navTo("campaign",{bpNum:u._sBP,caNum:u._sCA,coNum:u._sContract,typeV:"P"})):(u.getOwnerComponent().getCcuxApp().setOccupied(!1),sap.ui.commons.MessageBox.alert("SWAP Failed"),this.navTo("campaignoffers",{bpNum:u._sBP,caNum:u._sCA,coNum:u._sContract,typeV:"P"})),d.sap.log.info("Odata Read Successfully:::"+a.Code)}.bind(this),error:function(){d.sap.log.info("Eligibility Error occured")}.bind(this)},a.callFunction("/AcceptCampaign",b),this._oOverviewDialog.close()},h.prototype.onOvsDecline=function(){this._oOverviewDialog.close(),this.navTo("campaignoffers",{bpNum:this._sBP,caNum:this._sCA,coNum:this._sContract,typeV:"P"})},h.prototype.onDisposition=function(a){var b,c,e,f,g,h,i,j,k,l,m,n,o=this.getOwnerComponent().getModel("comp-campaign"),p=this;this.getOwnerComponent().getCcuxApp().setOccupied(!0),b=a.getSource().getBindingContext("comp-campaign").getPath(),e=o.getContext(b),g=e.getProperty("Campaign"),f=e.getProperty("Brand"),i=e.getProperty("OfferCode"),h=this._sCA,n=e.getProperty("Promo"),j=a.mParameters.selectedKey,k=e.getProperty("PromoRank"),l=e.getProperty("Contract"),m=e.getProperty("Type"),c={method:"POST",urlParameters:{Brand:f,CA:h,CampaignCode:g,Contract:l,DispoCode:j,OfferCode:i,PromoCode:n,PromoRank:k,Type:m},success:function(a){void 0!==a&&"S"===a.Code?(this.getOwnerComponent().getCcuxApp().setOccupied(!1),sap.ui.commons.MessageBox.alert("Disposition process is completed"),this.navTo("campaign",{bpNum:p._sBP,caNum:p._sCA,coNum:p._sContract,typeV:"C"})):(this.getOwnerComponent().getCcuxApp().setOccupied(!1),sap.ui.commons.MessageBox.alert("Disposition process is Failed"),this.navTo("campaignoffers",{bpNum:p._sBP,caNum:p._sCA,coNum:p._sContract,typeV:"P"})),d.sap.log.info("Odata Read Successfully:::"+a.Code)}.bind(this),error:function(){this.getOwnerComponent().getCcuxApp().setOccupied(!1),sap.ui.commons.MessageBox.alert("Disposition process is Failed")}.bind(this)},o.callFunction("/RejectCampaign",c)},h});