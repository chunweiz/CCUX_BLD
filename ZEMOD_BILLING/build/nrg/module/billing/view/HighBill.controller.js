sap.ui.define(["nrg/base/view/BaseController","sap/ui/model/Filter","sap/ui/model/FilterOperator","nrg/module/billing/view/ABPPopup"],function(a,b,c,d){"use strict";var e=a.extend("nrg.module.billing.view.HighBill");return e.prototype.onBeforeRendering=function(){var a,b,c,d,e,f,g=(this.getOwnerComponent().getModel("comp-highbill"),this.getView().byId("idnrgBillinvoiceDropdown")),h=this.getView().byId("idnrgBillDDitemTemplate").clone(),i=this,j=this.getView().byId("idnrgBillNotifications"),k=this.getView().byId("idnrgBillNotificationsTemp"),l=this.getOwnerComponent().getModel("comp-eligibility"),m=new sap.ui.model.json.JSONModel;this.getView().setModel(m,"hb-Eligiblity"),this.initRouterParameter(),this.getOwnerComponent().getCcuxApp().setTitle("BILL WIZARD"),this.getView().unbindElement("comp-highbill"),g.unbindAggregation("content"),j.unbindAggregation("content"),c="/BillWizardS",d=["Contract"],e=[this._coNum],b=this._createSearchFilterObject(d,e),f=function(){var a,b,c=g.getContent();void 0!==c&&c.length>0&&(b=c[0].getBindingContext("comp-highbill"),a=b.getPath(),g.setSelectedKey(b.getProperty("Begin")),i.getView().bindElement({model:"comp-highbill",path:a})),i.getOwnerComponent().getCcuxApp().setOccupied(!1)},a={model:"comp-highbill",path:c,template:h,filters:b,parameters:{expand:"CustDrv,NonCustDrv"},events:{dataReceived:f}},g.bindAggregation("content",a),c="/NotificationS",a={model:"comp-highbill",path:c,template:k,filters:b},j.bindAggregation("content",a),c="/EligCheckS('"+this._coNum+"')",a={success:function(a){m.setData(a)}.bind(this),error:function(){}.bind(this)},l&&l.read(c,a)},e.prototype.onAfterRendering=function(){var a=this.getView().byId("idnrgHighBill-CustDriv"),b=this.getView().byId("idnrgHighBill-NonCustDriv"),c=this.getView().byId("idnrgBillNoData");a&&a.getContent()&&a.getContent()[0].getContent()&&0===a.getContent()[0].getContent().length&&(a.getContent()[0].removeAllContent(),a.getContent()[0].addContent(c.clone())),b&&b.getContent()&&b.getContent()[0].getContent()&&0===b.getContent()[0].getContent().length&&(b.getContent()[0].removeAllContent(),b.getContent()[0].addContent(c.clone()))},a.prototype._createSearchFilterObject=function(a,d){var e,f=[];for(e=0;e<a.length;e+=1)f.push(new b(a[e],c.EQ,d[e],""));return f},e.prototype.initRouterParameter=function(){var a=this.getOwnerComponent().getCcuxRouteManager().getCurrentRouteInfo();this._bpNum=a.parameters.bpNum,this._caNum=a.parameters.caNum,this._coNum=a.parameters.coNum},e.prototype._onInvoiceSelect=function(a){var b,c,d=(this.getOwnerComponent().getModel("comp-highbill"),this.getView().byId("idnrgBillinvoiceDropdown"));c=a.getSource().getProperty("selectedKey"),d&&d.getContent()&&d.getContent().forEach(function(a){var d,e,f=a.getBindingContext("comp-highbill");if(c&&f.getProperty("Begin")){if(d=new Date(c),e=new Date(f.getProperty("Begin")),!d||!e)return;d.getTime()===e.getTime()&&(b=f.getPath())}}),b&&this.getView().bindElement({model:"comp-highbill",path:b})},e.prototype._onShowInvoice=function(a){var b,c=a.getSource().getBindingContext("comp-highbill");b=c.getProperty("InvURL"),window.open(b)},e.prototype._onBackToCheckBook=function(){var a=this.getOwnerComponent().getRouter();this._coNum?a.navTo("billing.CheckBook",{bpNum:this._bpNum,caNum:this._caNum,coNum:this._coNum}):a.navTo("billing.CheckBookNoCo",{bpNum:this._bpNum,caNum:this._caNum})},e.prototype._onRatehistory=function(){this._coNum&&this.navTo("campaignhistory",{bpNum:this._bpNum,caNum:this._caNum,coNum:this._coNum})},e.prototype._onUsagehistory=function(){this._coNum&&this.navTo("usage",{bpNum:this._bpNum,caNum:this._caNum,coNum:this._coNum,typeV:"B"})},e.prototype._onRetroAverageBillingClick=function(){this.ABPPopupCustomControl||(this.ABPPopupCustomControl=new d({isRetro:!0}),this.ABPPopupCustomControl._oABPPopup.setTitle("RETRO AVERAGE BILLING PLAN: ACTIVATE"),this.ABPPopupCustomControl.attachEvent("ABPCompleted",function(){},this),this.getView().addDependent(this.ABPPopupCustomControl)),this.ABPPopupCustomControl.prepareABP()},e.prototype._onAverageBillingClick=function(){this.ABPPopupCustomControl||(this.ABPPopupCustomControl=new d({isRetro:!1}),this.ABPPopupCustomControl._oABPPopup.setTitle("AVERAGE BILLING PLAN: ACTIVATE"),this.ABPPopupCustomControl.attachEvent("ABPCompleted",function(){},this),this.getView().addDependent(this.ABPPopupCustomControl)),this.ABPPopupCustomControl.prepareABP()},e});