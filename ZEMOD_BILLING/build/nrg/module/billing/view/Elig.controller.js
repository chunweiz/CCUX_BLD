sap.ui.define(["nrg/base/view/BaseController","sap/ui/model/Filter","sap/ui/model/FilterOperator","jquery.sap.global","sap/ui/model/json/JSONModel"],function(a,b,c){"use strict";var d=a.extend("nrg.module.billing.view.Elig");return d.prototype.onInit=function(){},d.prototype.onBeforeRendering=function(){},d.prototype.onAfterRendering=function(){this._OwnerComponent=this.getView().getParent().getParent().getParent().getController().getOwnerComponent(),this._EligPopupControl=this.getView().getParent(),this.getView().setModel(this._OwnerComponent.getModel("comp-eligibility"),"oDataEligSvc"),this.getView().setModel(new sap.ui.model.json.JSONModel,"oEligCriteria");var a=this._OwnerComponent.getCcuxRouteManager().getCurrentRouteInfo();this._bpNum=a.parameters.bpNum,this._caNum=a.parameters.caNum,this._coNum=a.parameters.coNum,this._initialCheck()},d.prototype._retrieveEligCrtTable=function(a,d){var e,f,g="/EligCriteriaS",h=[],i=this.getView().getModel("oDataEligSvc"),j=this.getView().getModel("oEligCriteria"),k={};h.push(new b({path:"Contract",operator:c.EQ,value1:this._coNum})),h.push(new b({path:"EligKey",operator:c.EQ,value1:a})),e={filters:h,success:function(a){for(f=0;f<a.results.length;f+=1)"EXTN"!==a.results[f].EligKey?(k.hasOwnProperty(a.results[f].Category)||(k[a.results[f].Category]={},k[a.results[f].Category].Title="CATEGORY "+a.results[f].Category,k[a.results[f].Category].Data=[]),a.results[f].Check=a.results[f].Mark,a.results[f].Uncheck=!a.results[f].Mark,delete a.results[f].Mark,""===a.results[f].Val1?(k[a.results[f].Category].Summary={},k[a.results[f].Category].Summary.visible=!0,k[a.results[f].Category].Summary.Check=a.results[f].Check,k[a.results[f].Category].Summary.Uncheck=!a.results[f].Check,k[a.results[f].Category].Summary.Message=a.results[f].Check?"ELIGIBLE":"NOT ELIGIBLE"):k[a.results[f].Category].Data.push(a.results[f])):(k.EXTN||(k.EXTN={},k.EXTN.Title="EXTENSION",k.EXTN.Data=[],k.EXTN.Summary={},k.EXTN.Summary.visible=!1),a.results[f].Check=a.results[f].Mark,a.results[f].Uncheck=!a.results[f].Mark,delete a.results[f].Mark,k.EXTN.Data.push(a.results[f]));j.setData(k),d&&d()}.bind(this),error:function(){d&&d()}.bind(this)},i&&i.read(g,e)},d.prototype._initialCheck=function(){var a,b=!1;this._OwnerComponent.getCcuxApp().setOccupied(!0),this._retrieveEligCrtTable(this.eligType,function(){b=!0}),a=setInterval(function(){b&&(this._OwnerComponent.getCcuxApp().setOccupied(!1),clearInterval(a))}.bind(this),100)},d.prototype._pad=function(a){return 10>a?"0"+a.toString():a.toString()},d.prototype.onPopupClose=function(){this.getView().getParent().close()},d});