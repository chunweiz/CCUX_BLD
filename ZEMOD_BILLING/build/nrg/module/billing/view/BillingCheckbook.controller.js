sap.ui.define(["jquery.sap.global","nrg/base/view/BaseController","nrg/base/type/Price","nrg/module/quickpay/view/QuickPayControl","nrg/module/billing/view/EligPopup"],function(a,b,c,d,e){"use strict";var f=b.extend("nrg.module.billing.view.BillingCheckbook");return f.prototype.onInit=function(){},f.prototype.onBeforeRendering=function(){this.getOwnerComponent().getCcuxApp().setTitle("BILLING"),this.getView().setModel(this.getOwnerComponent().getModel("comp-billing"),"oDataSvc"),this.getView().setModel(this.getOwnerComponent().getModel("comp-eligibility"),"oDataEligSvc"),this.getView().setModel(new sap.ui.model.json.JSONModel,"oChkbkHdr"),this.getView().setModel(new sap.ui.model.json.JSONModel,"oPaymentHdr"),this.getView().setModel(new sap.ui.model.json.JSONModel,"oPostInvoiceItems"),this.getView().setModel(new sap.ui.model.json.JSONModel,"oEligibility"),this._initRoutingInfo(),this._initChkbookHdr(),this._initPaymentHdr(),this._initPostInvoiceItems();var a=this.getOwnerComponent().getCcuxContextManager().getContext().oData;this._bpNum=a.bpNum,this._caNum=a.caNum,this._coNum=a.coNum},f.prototype.onAfterRendering=function(){this.getOwnerComponent().getCcuxApp().updateFooterNotification(this._bpNum,this._caNum,this._coNum,!0),this.getOwnerComponent().getCcuxApp().updateFooterRHS(this._bpNum,this._caNum,this._coNum,!0),this.getOwnerComponent().getCcuxApp().updateFooterCampaign(this._bpNum,this._caNum,this._coNum,!0),this._retrieveNotification()},f.prototype.onExit=function(){},f.prototype._formatPostClotGrn=function(a){return"G"===a?!0:!1},f.prototype._formatPostClotRed=function(a){return"R"===a?!0:!1},f.prototype._formatPostInv2VL=function(a,b){return"L"!==a||b?!1:!0},f.prototype._formatPostInv2VR=function(a,b){return"R"!==a||b?!1:!0},f.prototype._formatPostInv1V=function(a,b){return"H"!==a||b?!1:!0},f.prototype._formatDppIntGrn=function(a){return"G"===a?!0:!1},f.prototype._formatDppIntYlw=function(a){return"Y"===a?!0:!1},f.prototype._formatDppIntRed=function(a){return"R"===a?!0:!1},f.prototype._formatDppIntWte=function(a){return"W"===a?!0:!1},f.prototype._formatBoolHyperLink=function(a){return a?!0:!1},f.prototype._formatBoolDP=function(a){return"DP"===a?!0:!1},f.prototype._formatBoolLP=function(a){return"LP"===a?!0:!1},f.prototype._formatBoolBB=function(a){return"BB"===a?!0:!1},f.prototype._formatBoolCurChrg=function(a){return"X"===a||"x"===a?!0:!1},f.prototype._formatBoolNormalPitem=function(a,b){return a||b?!1:!0},f.prototype._formatTwoClotBoolean=function(a){return a?!0:!1},f.prototype._formatBppBoolean=function(a){return"BBP"===a?!0:!1},f.prototype._formatFirstClotBlk=function(a,b,c){return"BBP"===a?!1:c?!1:b?!1:!0},f.prototype._formatFirstClotGrn=function(a,b,c){return"BBP"===a?!1:c?!1:b?!0:!1},f.prototype._formatFirstClotRed=function(a,b,c){return"BBP"===a?!1:c?!0:b?!1:!1},f.prototype._formatClotTTCurrent=function(a,b,c){return"BBP"===a?!1:"RED"===b?!1:c?!0:!1},f.prototype._formatClotTTDppCncl=function(a,b){return"BBP"===a?!1:"RED"===b?!0:!1},f.prototype._formatClotTTDInactive=function(a,b,c){return"BBP"===a?!1:"RED"===b?!1:c?!1:!0},f.prototype._formatNotBppBoolean=function(a){return"BBP"===a?!1:!0},f.prototype._formatDate=function(a){var b;return a?b=(a.getMonth()+1).toString()+"/"+a.getDate().toString()+"/"+a.getFullYear().toString().substring(2,4):null},f.prototype._getCurDate=function(){var a,b=new Date;return a=(b.getMonth()+1).toString()+"/"+b.getDate().toString()+"/"+b.getFullYear().toString().substring(2,4)},f.prototype._getPreSixMonthDate=function(){var a,b=new Date;return b.setMonth(b.getMonth()-6),a=(b.getMonth()+1).toString()+"/"+b.getDate().toString()+"/"+b.getFullYear().toString().substring(2,4)},f.prototype._formatLfRtZroVal=function(a){return"0.00"===a||"0"===a?" ":a},f.prototype._onPaymentHdrClicked=function(a){var b,c=this.getView().getModel("oPaymentHdr");b=a.oSource.oBindingContexts.oPaymentHdr.getPath(),c.getProperty(b+"/bExpand")&&(this._retrPayments(c.getProperty(b).InvoiceNum,b),this._retrPaymentItmes(c.getProperty(b).InvoiceNum,b),this._retrPaymentSumrys(c.getProperty(b).InvoiceNum,b))},f.prototype._onPaymentOptionClick=function(){var a=new d;this.getView().addDependent(a),this._coNum&&a.openQuickPay(this._coNum,this.bpNum,this.caNum)},f.prototype._onHighBillFactorClick=function(){var a=this.getOwnerComponent().getRouter();this._coNum?a.navTo("billing.HighBill",{bpNum:this._bpNum,caNum:this._caNum,coNum:this._coNum}):a.navTo("billing.HighBillNoCo",{bpNum:this._bpNum,caNum:this._caNum})},f.prototype._onLiteUpLinkClicked=function(){var a="http://www.puc.state.tx.us/consumer/lowincome/Assistance.aspx";window.open(a)},f.prototype._retrPayments=function(a,b){var c,d,e=this.getView().getModel("oDataSvc");c="/PaymentHdrs('"+a+"')/Payments",d={success:function(a){a&&this.getView().getModel("oPaymentHdr").setProperty(b+"/Payments",a)}.bind(this),error:function(){}.bind(this)},e&&e.read(c,d)},f.prototype._retrPaymentItemDppTable=function(a,b,c){var d,e,f=this.getView().getModel("oDataSvc");d="/PaymentItems(ContractAccountNumber='',InvoiceNum='"+a+"',Opbel='"+b+"')/DPPPlan",e={success:function(a){a&&this.getView().getModel("oPaymentHdr").setProperty(c+"/DpInstls",a)}.bind(this),error:function(){}.bind(this)},f&&f.read(d,e)},f.prototype._retrPaymentItmes=function(a,b){var c,d,e,f=this.getView().getModel("oDataSvc");c="/PaymentHdrs('"+a+"')/PaymentItems",d={success:function(a){if(a)for(this.getView().getModel("oPaymentHdr").setProperty(b+"/PaymentItems",a),e=0;e<a.results.length;e+=1)"DP"===a.results[e].HyperLinkInd&&this._retrPaymentItemDppTable(a.results[e].InvoiceNum,a.results[e].Opbel,b+"/PaymentItems/results/"+e.toString())}.bind(this),error:function(){}.bind(this)},f&&f.read(c,d)},f.prototype._retrPaymentSumrys=function(a,b){var c,d,e=this.getView().getModel("oDataSvc");c="/PaymentHdrs('"+a+"')/PaymentSumry",d={success:function(a){a.results&&this.getView().getModel("oPaymentHdr").setProperty(b+"/PaymentSumry",a.results[0])}.bind(this),error:function(){}.bind(this)},e&&e.read(c,d)},f.prototype._initRoutingInfo=function(){var a=this.getOwnerComponent().getCcuxRouteManager().getCurrentRouteInfo();this._bpNum=a.parameters.bpNum,this._caNum=a.parameters.caNum,this._coNum=a.parameters.coNum},f.prototype._initChkbookHdr=function(){var a;a=this.getOwnerComponent()._oMockDataManager._aMockServers.length?"/ChkBookHdrs(ContractAccountID='"+this._caNum+"',InvoiceNum='8005303668')":"/ChkBookHdrs(ContractAccountID='"+this._caNum+"',InvoiceNum='')",this._retrChkbookHdr(a)},f.prototype._initPaymentHdr=function(){var a;a="/ConfBuags('"+this._caNum+"')/PaymentHdrs",this._retrPaymentHdr(a)},f.prototype._initPostInvoiceItems=function(){var a;a="/ConfBuags('"+this._caNum+"')/PostInvoice",this._retrPostInvoiceItems(a)},f.prototype._retrChkbookHdr=function(a){var b,c=this.getView().getModel("oDataSvc");b={success:function(a){a&&this.getView().getModel("oChkbkHdr").setData(a)}.bind(this),error:function(){}.bind(this)},c&&c.read(a,b)},f.prototype._retrPaymentHdr=function(a){{var b,c,d,e=this.getView().getModel("oDataSvc"),f=new Date;this.getView().byId("nrgChkbookScrollContainer")}b={success:function(a){if(a){for(c=0;c<a.results.length;c+=1){if(a.results[c].oCallOut={},a.results[c].CallOut){for(a.results[c].oCallOut=JSON.parse(a.results[c].CallOut),a.results[c].bRed=!1,d=0;d<a.results[c].oCallOut.CallOuts.length;d+=1)"BBP"===a.results[c].oCallOut.CallOuts[d].CallOut&&(a.results[c].oCallOut.CallOuts[d].BBPAmt=a.results[c].BBPAmt,a.results[c].oCallOut.CallOuts[d].BBPAmtAddr=a.results[c].BBPAmtAddr,a.results[c].oCallOut.CallOuts[d].BBPBal=a.results[c].BBPBal,a.results[c].oCallOut.CallOuts[d].BBPBalAddr=a.results[c].BBPBalAddr,a.results[c].oCallOut.CallOuts[d].BBPDefBal=a.results[c].BBPDefBal,a.results[c].oCallOut.CallOuts[d].BBPDefBalTxt=a.results[c].BBPDefBalTxt),"RED"===a.results[c].oCallOut.CallOuts[d].Color&&(a.results[c].bRed=!0),a.results[c].oCallOut.CallOuts[d].bCurrent=c===a.results.length-1?!0:!1;1===a.results[c].oCallOut.CallOuts.length?a.results[c].sCallOut=a.results[c].oCallOut.CallOuts[0].CallOut:2===a.results[c].oCallOut.CallOuts.length?(a.results[c].sCallOut=a.results[c].oCallOut.CallOuts[0].CallOut,a.results[c].sCallOut2=a.results[c].oCallOut.CallOuts[1].CallOut):(a.results[c].sCallOut=a.results[c].oCallOut.CallOuts.length+"+",this.getView().byId("ChkbookHdrClOt").setVisible(!0))}c!==a.results.length-1?(a.results[c].bExpand=!1,a.results[c].bExpand_0=!1):(a.results[c].bExpand=!0,a.results[c].bExpand_0=!0),a.results[c].bRegul=!0,a.results[c].bAlert=!1}c-=1,a.results[c].DueDate<f&&(a.results[c].bAlert=!0,a.results[c].bRegul=!1),this.getView().getModel("oPaymentHdr").setData(a),this._retrPayments(a.results[c].InvoiceNum,"/results/"+c),this._retrPaymentSumrys(a.results[c].InvoiceNum,"/results/"+c),this._retrPaymentItmes(a.results[c].InvoiceNum,"/results/"+c)}}.bind(this),error:function(){}.bind(this)},e&&e.read(a,b)},f.prototype._retrPostInvoiceItems=function(a){var b,c,d=this.getView().getModel("oDataSvc"),e=this.getView().byId("nrgChkbookScrollContainer");b={success:function(a){if(a)for(this.getView().getModel("oPostInvoiceItems").setData(a),c=0;c<a.results.length;c+=1)"DP"===a.results[c].HyperLinkInd&&this._retrPostInvoiceItemDppTable(a.results[c].InvoiceNum,a.results[c].Opbel,"/results/"+c.toString());e.scrollTo(0,1e3,1e3)}.bind(this),error:function(){}.bind(this)},d&&d.read(a,b)},f.prototype._retrPostInvoiceItemDppTable=function(a,b,c){var d,e,f=this.getView().getModel("oDataSvc"),g=this.getView().byId("nrgChkbookScrollContainer");d="/PostInvoices(ContractAccountNumber='"+this._caNum+"',InvoiceNum='',Opbel='"+b+"')/DPPPlans",e={success:function(a){a&&this.getView().getModel("oPostInvoiceItems").setProperty(c+"/DpInstls",a),g.scrollTo(0,1e3,1e3)}.bind(this),error:function(){}.bind(this)},f&&f.read(d,e)},f.prototype._onBackToBilling=function(){var a=this.getOwnerComponent().getRouter();this._coNum?a.navTo("billing.BillingInfo",{bpNum:this._bpNum,caNum:this._caNum,coNum:this._coNum}):a.navTo("billing.BillingInfoNoCo",{bpNum:this._bpNum,caNum:this._caNum})},f.prototype._retrieveNotification=function(){var a,b,c,d="/EligCheckS('"+this._coNum+"')",e=this.getView().getModel("oDataEligSvc"),f=this.getView().getModel("oEligibility");a={success:function(a){f.setData(a);var d=this.getView().byId("nrgBilling-billChkBook-notifications");if(!this._eligibilityAlerts)for(this._eligibilityAlerts=[],b=new ute.ui.app.FooterNotificationItem({link:!0,design:"Information",text:a.ABPElig?"Eligible for ABP":"Not eligible for ABP",linkPress:this._openEligABPPopup.bind(this)}),this._eligibilityAlerts.push(b),b=new ute.ui.app.FooterNotificationItem({link:!0,design:"Information",text:a.EXTNElig?"Eligible for EXTN":"Not eligible for EXTN",linkPress:this._openEligEXTNPopup.bind(this)}),this._eligibilityAlerts.push(b),b=new ute.ui.app.FooterNotificationItem({link:!0,design:"Information",text:a.RBBElig?"Eligible for Retro-AB":"Not eligible for Retro-AB",linkPress:this._openEligRBBPopup.bind(this)}),this._eligibilityAlerts.push(b),b=new ute.ui.app.FooterNotificationItem({link:!0,design:"Information",text:a.DPPElig?"Eligible for DPP":"Not eligible for DPP"}),this._eligibilityAlerts.push(b),c=0;c<this._eligibilityAlerts.length;c+=1)this._eligibilityAlerts[c].placeAt(d)}.bind(this),error:function(){}.bind(this)},e&&e.read(d,a)},f.prototype._openEligABPPopup=function(){this.EligABPPopupCustomControl||(this.EligABPPopupCustomControl=new e({eligType:"ABP"}),this.EligABPPopupCustomControl.attachEvent("EligCompleted",function(){},this),this.getView().addDependent(this.EligABPPopupCustomControl),this.EligABPPopupCustomControl._oEligPopup.setTitle("ELIGIBILITY CRITERIA - AVERAGE BILLING PLAN")),this.EligABPPopupCustomControl.prepare()},f.prototype._openEligEXTNPopup=function(){this.EligEXTNPopupCustomControl||(this.EligEXTNPopupCustomControl=new e({eligType:"EXTN"}),this.EligEXTNPopupCustomControl.attachEvent("EligCompleted",function(){},this),this.getView().addDependent(this.EligEXTNPopupCustomControl),this.EligEXTNPopupCustomControl._oEligPopup.setTitle("ELIGIBILITY CRITERIA - EXTENSION")),this.EligEXTNPopupCustomControl.prepare()},f.prototype._openEligRBBPopup=function(){this.EligRBBPopupCustomControl||(this.EligRBBPopupCustomControl=new e({eligType:"RBB"}),this.EligRBBPopupCustomControl.attachEvent("EligCompleted",function(){},this),this.getView().addDependent(this.EligRBBPopupCustomControl),this.EligRBBPopupCustomControl._oEligPopup.setTitle("ELIGIBILITY CRITERIA - RETRO BILLING PLAN")),this.EligRBBPopupCustomControl.prepare()},f});