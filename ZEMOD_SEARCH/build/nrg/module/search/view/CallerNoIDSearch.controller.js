sap.ui.define(["nrg/base/view/BaseController","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/ui/core/routing/HashChanger","nrg/base/type/ContractAccountNumber"],function(a,b,c){"use strict";var d=a.extend("nrg.module.search.view.CallerNoIDSearch");return d.prototype.onBeforeRendering=function(){this.getOwnerComponent().getCcuxApp().setTitle("CUSTOMER DATA"),this.getView().setModel(this.getOwnerComponent().getModel("comp-search"),"oSearchBpODataModel"),this.getView().setModel(new sap.ui.model.json.JSONModel,"oBpSearchResult"),this.getView().setModel(new sap.ui.model.json.JSONModel,"oBpSearchCount"),this.getView().setModel(new sap.ui.model.json.JSONModel,"oSearchFilters"),this.getView().setModel(new sap.ui.model.json.JSONModel,"oSearchWithCA"),this._initSearchCaModel(),this._initSearchFilterModel(),this._initSearchResultModel(),this._closeAllOpenedWindows()},d.prototype._closeAllOpenedWindows=function(){var a=this.getOwnerComponent().getCcuxWebUiManager();a.isAvailable()&&a.notifyWebUi("gotoSearch")},d.prototype._initSearchCaModel=function(){this.getView().getModel("oSearchWithCA").setProperty("/searchedInCa",!1),this.getView().getModel("oSearchWithCA").setProperty("/searchedCaNum",null)},d.prototype._initSearchResultModel=function(){this.getView().getModel("oBpSearchCount").setProperty("/searchCount",0),this.getView().getModel("oBpSearchCount").setProperty("/searchCountOver100",!1),this.getView().getModel("oBpSearchCount").setProperty("/searchCountBelow100",!1)},d.prototype._initSearchFilterModel=function(){var a={sCaNum:null,sSsn:null,sDl:null,sOrgName:null,sBpNum:null,sFiName:null,sEsid:null,sLaName:null,sPhnNum:null,sHousNum:null,sStreetNum:null,sUnitNum:null,sCityNum:null,sStateNum:null,sZipNum:null,sTaxID:null};this.getView().getModel("oSearchFilters").setProperty("/searchTextFields",a)},d.prototype.onEnterKeyPress=function(){this.onSearch()},d.prototype.onTextFieldChange=function(){},d.prototype.onSearch=function(){this.getOwnerComponent().getCcuxApp().setOccupied(!0),this._searchBP("/BpSearchs",this._createSearchParameters())},d.prototype._createSearchFilterObject=function(){var a,d=[],e=this.getView().getModel("oSearchFilters"),f=this.getView().getModel("oSearchWithCA");return f.setProperty("/searchedInCa",!1),e.getProperty("/searchTextFields/sHousNum")&&(a=new b({path:"HouseNumber",operator:c.EQ,value1:e.getProperty("/searchTextFields/sHousNum")}),d.push(a)),e.getProperty("/searchTextFields/sStreetNum")&&(a=new b({path:"Street",operator:c.EQ,value1:e.getProperty("/searchTextFields/sStreetNum")}),d.push(a)),e.getProperty("/searchTextFields/sUnitNum")&&(a=new b({path:"UnitNumber",operator:c.EQ,value1:e.getProperty("/searchTextFields/sUnitNum")}),d.push(a)),e.getProperty("/searchTextFields/sCityNum")&&(a=new b({path:"City",operator:c.EQ,value1:e.getProperty("/searchTextFields/sCityNum")}),d.push(a)),e.getProperty("/searchTextFields/sStateNum")&&(a=new b({path:"State",operator:c.EQ,value1:e.getProperty("/searchTextFields/sStateNum")}),d.push(a)),e.getProperty("/searchTextFields/sZipNum")&&(a=new b({path:"ZipCode",operator:c.EQ,value1:e.getProperty("/searchTextFields/sZipNum")}),d.push(a)),e.getProperty("/searchTextFields/sPhnNum")&&(a=new b({path:"TelePhone",operator:c.EQ,value1:e.getProperty("/searchTextFields/sPhnNum")}),d.push(a)),e.getProperty("/searchTextFields/sCaNum")&&(f.setProperty("/searchedInCa",!0),f.setProperty("/searchedCaNum",e.getProperty("/searchTextFields/sCaNum").trim()),a=new b({path:"BuagID",operator:c.EQ,value1:e.getProperty("/searchTextFields/sCaNum").trim()}),d.push(a)),e.getProperty("/searchTextFields/sSsn")&&(a=new b({path:"SSN",operator:c.EQ,value1:e.getProperty("/searchTextFields/sSsn")}),d.push(a)),e.getProperty("/searchTextFields/sDl")&&(a=new b({path:"DL",operator:c.EQ,value1:e.getProperty("/searchTextFields/sDl")}),d.push(a)),e.getProperty("/searchTextFields/sOrgName")&&(a=new b({path:"OrgName",operator:c.EQ,value1:e.getProperty("/searchTextFields/sOrgName")}),d.push(a)),e.getProperty("/searchTextFields/sBpNum")&&(a=new b({path:"PartnerID",operator:c.EQ,value1:e.getProperty("/searchTextFields/sBpNum")}),d.push(a)),e.getProperty("/searchTextFields/sFiName")&&(a=new b({path:"FirstName",operator:c.EQ,value1:e.getProperty("/searchTextFields/sFiName")}),d.push(a)),e.getProperty("/searchTextFields/sEsid")&&(a=new b({path:"ESID",operator:c.EQ,value1:e.getProperty("/searchTextFields/sEsid")}),d.push(a)),e.getProperty("/searchTextFields/sLaName")&&(a=new b({path:"LastName",operator:c.EQ,value1:e.getProperty("/searchTextFields/sLaName")}),d.push(a)),e.getProperty("/searchTextFields/sTaxID")&&(a=new b({path:"TaxID",operator:c.EQ,value1:e.getProperty("/searchTextFields/sTaxID")}),d.push(a)),d},d.prototype._createSearchParameters=function(){var a,b,c,d=this._createSearchFilterObject(),e=(this.getOwnerComponent().getRouter(),this.getOwnerComponent()),f=e.getCcuxWebUiManager();return a={filters:d,success:function(a){if(a.results)if($(".uteApp-body").animate({scrollTop:$(document).height()},"slow"),1===a.results.length)f.isAvailable()?f.notifyWebUi("bpConfirmed",{BP_NUM:a.results[0].PartnerID},this._handleBpConfirmed,this):(c={BP_NUM:a.results[0].PartnerID,getParameters:function(){return c}},this._handleBpConfirmed(c));else{for(b=0;b<a.results.length;b+=1)a.results[b].iId=b+1,a.results[b].Select="Select";this.getView().getModel("oBpSearchResult").setData(a.results),this.getView().getModel("oBpSearchCount").setProperty("/searchCount",a.results.length),a.results.length>=100?(this.getView().getModel("oBpSearchCount").setProperty("/searchCountOver100",!0),this.getView().getModel("oBpSearchCount").setProperty("/searchCountBelow100",!1)):(this.getView().getModel("oBpSearchCount").setProperty("/searchCountOver100",!1),this.getView().getModel("oBpSearchCount").setProperty("/searchCountBelow100",!0)),e.getCcuxApp().setOccupied(!1)}}.bind(this),error:function(){this.getView().getModel("oBpSearchResult").setData(null)}.bind(this)}},d.prototype._searchBP=function(a,b){var c=this.getView().getModel("oSearchBpODataModel");c&&this._checkWildCard(b)&&c.read(a,b)},d.prototype._checkWildCard=function(a){var b=!0;return a.filters.forEach(function(a){("BuagID"===a.sPath||"SSN"===a.sPath||"DL"===a.sPath||"PartnerID"===a.sPath||"ESID"===a.sPath||"TaxID"===a.sPath||"TelePhone"===a.sPath||"UnitNumber"===a.sPath)&&a.oValue1.indexOf("*")>-1&&(sap.ui.commons.MessageBox.alert("Wildcard is not allowed for this search criteria."),b=!1)}),b?!0:(this.getOwnerComponent().getCcuxApp().setOccupied(!1),!1)},d.prototype._onBpSelect=function(a){var b,c=a.getParameters().id,d=c.split("-"),e=d[2],f=this.getView().getModel("oBpSearchResult").oData[e].PartnerID,g=this.getOwnerComponent(),h=g.getCcuxWebUiManager();g.getCcuxApp().setOccupied(!0),h.isAvailable()?h.notifyWebUi("bpConfirmed",{BP_NUM:f},this._handleBpConfirmed,this):(b={BP_NUM:f,getParameters:function(){return b}},this._handleBpConfirmed(b))},d.prototype._handleBpConfirmed=function(a){var b=this.getOwnerComponent().getRouter(),c=(this.getOwnerComponent(),this.getOwnerComponent().getCcuxContextManager().getContext()),d=a.getParameters(),e=this.getView().getModel("oSearchWithCA");c.setProperty("/bpNum",d.BP_NUM),e.getProperty("/searchedInCa")?b.navTo("dashboard.VerificationWithCa",{bpNum:d.BP_NUM,caNum:e.getProperty("/searchedCaNum")}):b.navTo("dashboard.Verification",{bpNum:d.BP_NUM})},d});