sap.ui.define(["jquery.sap.global","./library","sap/ui/core/Control","sap/ui/core/Popup"],function(a,b,c,d){"use strict";var e=c.extend("ute.ui.commons.Dialog",{metadata:{interfaces:["sap.ui.core.PopupInterface"],library:"ute.ui.commons",properties:{title:{type:"string",group:"Misc",defaultValue:""},width:{type:"sap.ui.core.CSSSize",group:"Dimension",defaultValue:null},height:{type:"sap.ui.core.CSSSize",group:"Dimension",defaultValue:null},scrollLeft:{type:"int",group:"Behavior",defaultValue:0},scrollTop:{type:"int",group:"Behavior",defaultValue:0},applyContentPadding:{type:"boolean",group:"Appearance",defaultValue:!0},showCloseButton:{type:"boolean",group:"Behavior",defaultValue:!0},resizable:{type:"boolean",group:"Behavior",defaultValue:!0},minWidth:{type:"sap.ui.core.CSSSize",group:"Dimension",defaultValue:null},minHeight:{type:"sap.ui.core.CSSSize",group:"Dimension",defaultValue:null},maxWidth:{type:"sap.ui.core.CSSSize",group:"Dimension",defaultValue:null},maxHeight:{type:"sap.ui.core.CSSSize",group:"Dimension",defaultValue:null},contentBorderDesign:{type:"sap.ui.commons.enums.BorderDesign",group:"Appearance",defaultValue:sap.ui.commons.enums.BorderDesign.None},modal:{type:"boolean",group:"Misc",defaultValue:!1},accessibleRole:{type:"sap.ui.core.AccessibleRole",group:"Accessibility",defaultValue:sap.ui.core.AccessibleRole.Dialog},keepInWindow:{type:"boolean",group:"Behavior",defaultValue:!1},autoClose:{type:"boolean",group:"Misc",defaultValue:!1}},defaultAggregation:"content",aggregations:{buttons:{type:"sap.ui.core.Control",multiple:!0,singularName:"button"},content:{type:"sap.ui.core.Control",multiple:!0,singularName:"content"}},associations:{defaultButton:{type:"sap.ui.commons.Button",multiple:!1},initialFocus:{type:"sap.ui.core.Control",multiple:!1}},events:{parameters:{width:{type:"int"},height:{type:"int"},top:{type:"int"},left:{type:"int"}}}}});return e.prototype.init=function(){this.oPopup=new d(this,!0,!0);var a=d.Dock;this.oPopup.setPosition(a.CenterCenter,a.CenterCenter,window),this._minWidth=64,this._minHeight=48,this.allowTextSelection(!1),this._mParameters={},this._mParameters.that=this,this._mParameters.firstFocusable=this.getId()+"-fhfe",this._mParameters.lastFocusable=this.getId()+"-fhee"},e.prototype.setInitialFocus=function(a){null!==a&&"string"!=typeof a&&(a=a.getId()),this.oPopup.setInitialFocusId(a),this.setAssociation("initialFocus",a,!0)},e.prototype.onAfterRendering=function(){var b,c,d,f,g,h,i,j=this.$("cont");e._isSizeSet(this.getWidth())||e._isSizeSet(this.getMaxWidth())||j.children().each(function(){"100%"===a.trim(this.style.width)&&(this.style.width="auto")}),sap.ui.Device.browser.internet_explorer&&(9===sap.ui.Device.browser.version||10===sap.ui.Device.browser.version)&&j.length>0&&(b=j[0],sap.ui.getCore().getConfiguration().getRTL()&&!e._isSizeSet(this.getWidth())&&b.ownerDocument&&b.ownerDocument.defaultView&&b.ownerDocument.defaultView.getComputedStyle&&(c=b.ownerDocument.defaultView.getComputedStyle(b).getPropertyValue("width"),c&&(d=parseFloat(c,10),d%1===.5&&(j[0].style.width=d+.01+"px")))),!e._isSizeSet(this.getHeight())&&e._isSizeSet(this.getMinHeight())&&(f=this.getDomRef("footer"),g=f.offsetTop+f.offsetHeight,h=this.getDomRef().offsetHeight,h>g&&this.$().removeClass("sapUiDlgFlexHeight")),i=this.getMinSize(),this._minWidth=i.width,this._minHeight=i.height},e.prototype.onclick=function(a){switch(a.target.id){case this.getId()+"-close":this.close(),a.preventDefault()}return!1},e.prototype.open=function(){this.oPopup?this._bOpen||(this._oPreviousFocus=d.getCurrentFocusInfo(),this.oPopup.attachEvent("opened",this.handleOpened,this),this.oPopup.attachEvent("closed",this.handleClosed,this),this.oPopup.setModal(this.getModal()),this.oPopup.setAutoClose(this.getAutoClose()),this.oPopup.open(400),this._bOpen=!0):a.sap.log.fatal("This dialog instance has been destroyed already")},e.prototype._handleOpened=function(){this.$().show();var a,b=this.getInitialFocus();b&&a===sap.ui.getCore().getControl(b)?(a.focus(),this._bInitialFocusSet=!0):(b=this.getDefaultButton(),b&&a===sap.ui.getCore().getControl(b)&&a.getParent()===this?(a.focus(),this._bInitialFocusSet=!0):this.getButtons().length>0?(this.getButtons()[0].focus(),this._bInitialFocusSet=!0):this.getContent().length>0&&(this.getContent()[0].focus(),this._bInitialFocusSet=!0))},e.prototype.handleOpened=function(){this.oPopup.detachEvent("opened",this.handleOpened,this),sap.ui.Device.browser.internet_explorer&&11===sap.ui.Device.browser.version?(a.sap.clearDelayedCall(this._delayedCallId),this._delayedCallId=a.sap.delayedCall(0,this,this._handleOpened)):this._handleOpened()},e.prototype.close=function(){if(this._bOpen){var b=this.$().rect();this._bOpen=!1,this._bInitialFocusSet=!1,this.oPopup.isOpen()&&this.oPopup.close(400),a.sap.delayedCall(400,this,"restorePreviousFocus"),a.each(b,function(a,c){b[a]=parseInt(c,10)}),this._oRect=b}},e.prototype.handleClosed=function(){this.oPopup.detachEvent("closed",this.handleClosed,this),this.fireClosed(this._oRect),this.close(),this.$().hide()},e.prototype.restorePreviousFocus=function(){d.applyFocusInfo(this._oPreviousFocus)},e.prototype.setTitle=function(a){return this.setProperty("title",a,!0),this.$("lbl").text(a),this},e.prototype.exit=function(){var a=this.isOpen();this.close(),this.oPopup.detachEvent("opened",this.handleOpened,this),this.oPopup.detachEvent("closed",this.handleClosed,this),this.oPopup.destroy(),a&&this.fireClosed(this._oRect),this.oPopup=null,delete this._mParameters},e._isSizeSet=function(a){return a&&"auto"!==a&&"inherit"!==a},e.prototype.onsapescape=function(a){this.close(),a.preventDefault(),a.stopPropagation()},e.prototype.onsapenter=function(b){var c,d=this.getDefaultButton();d&&c===sap.ui.getCore().byId(d)&&a.contains(this.getDomRef(),c.getDomRef())&&c instanceof sap.ui.commons.Button&&c.onclick(b),b.preventDefault(),b.stopPropagation()},e.prototype.onfocusin=function(b){this.sLastRelevantNavigation=null,this._bInitialFocusSet&&(this._mParameters.event=b,this._mParameters.$FocusablesContent=a(":sapFocusable",this.$("cont")),this._mParameters.$FocusablesFooter=a(":sapFocusable",this.$("footer")),this.oPopup.focusTabChain(this._mParameters))},e.prototype.restoreFocus=function(){if(this.oRestoreFocusInfo&&this.oPopup.bOpen){var a=sap.ui.getCore().getControl(this.oRestoreFocusInfo.sFocusId);a&&a.applyFocusInfo(this.oRestoreFocusInfo.oFocusInfo)}},e.prototype.onselectstart=function(b){a.sap.containsOrEquals(this.getDomRef("cont"),b.target)||(b.preventDefault(),b.stopPropagation())},e.prototype.getMinSize=function(){var b=a.sap.domById(this.sId),c=(a.sap.domById(this.sId+"-hdr"),a.sap.domById(this.sId+"-footer")),d=0,e=0,f=0,g=0;return g+=a(c).outerWidth(!1)-a(c).width(),g+=a(b).outerWidth(!1)-a(b).width(),20>=g&&(g=20),e+=g,(isNaN(e)||100>e)&&(e=100),{width:e,height:d+f+36}},e.prototype.isOpen=function(){return this.oPopup.isOpen()},e.prototype.getOpenState=function(){return this.oPopup.getOpenState()},e.prototype.getEnabled=function(){var a=this.getOpenState();return a===sap.ui.core.OpenState.OPENING||a===sap.ui.core.OpenState.OPEN},e.prototype.ondragstart=function(a){("resize"===this.sDragMode||"move"===this.sDragMode)&&(a.preventDefault(),a.stopPropagation())},e.prototype.onmousedown=function(b){var c,d,f,g,h,i,j=b.target,k=this.getId();this._bRtlMode=sap.ui.getCore().getConfiguration().getRTL(),a.sap.containsOrEquals(this.getDomRef("hdr"),j)?j.id!==k+"-close"&&(this.sDragMode="move",this._RootWidth=this.getDomRef().offsetWidth,this._RootHeight=this.getDomRef().offsetHeight):j.id===k+"-grip"&&(this.sDragMode="resize",c=this.getDomRef(),d=c.offsetWidth+"px",c.style.width=d,f=c.offsetHeight+"px",c.style.height=f,a(c).removeClass("sapUiDlgFlexHeight sapUiDlgFlexWidth"),this.setProperty("width",d,!0),this.setProperty("height",f,!0)),null!==this.sDragMode&&(g=document.activeElement,g&&g.id&&(h=a.sap.byId(g.id).control(0),h&&(this.oRestoreFocusInfo={sFocusId:h.getId(),oFocusInfo:h.getFocusInfo()})),this.startDragX=b.screenX,this.startDragY=b.screenY,this.originalRectangle=this.$().rect(),a(window.document).bind("selectstart",a.proxy(this.ondragstart,this)),a(window.document).bind("mousemove",a.proxy(this.handleMove,this)),a(window.document).bind("mouseup",a.proxy(this.handleMouseUp,this)),i=e._findSameDomainParentWinDoc(),i&&(a(i).bind("selectstart",a.proxy(this.ondragstart,this)),a(i).bind("mousemove",a.proxy(this.handleMove,this)),a(i).bind("mouseup",a.proxy(this.handleMouseUp,this))))},e._findSameDomainParentWinDoc=function(){var a,b=null;try{for(a=window;a.parent&&a.parent!==a;)a.parent.document&&(b=a.parent.document,a=a.parent)}catch(c){}return b},e.prototype.handleMove=function(a){var b,c,e,f,g,h,i;if(this.sDragMode)return a=a||window.event,"resize"===this.sDragMode?(b=a.screenX-this.startDragX,c=a.screenY-this.startDragY,e=this._bRtlMode?this.originalRectangle.width-b:this.originalRectangle.width+b,f=this.originalRectangle.height+c,e=Math.max(e,this._minWidth),f=Math.max(f,this._minHeight),g=this.getDomRef(),g.style.width=e+"px",g.style.height=f+"px",e=this.getDomRef().offsetWidth,f=this.getDomRef().offsetHeight,g.style.width=e+"px",g.style.height=f+"px",this.setProperty("width",e+"px",!0),this.setProperty("height",f+"px",!0)):"move"===this.sDragMode&&(h=this.originalRectangle.left+a.screenX-this.startDragX,i=this.originalRectangle.top+a.screenY-this.startDragY,i=Math.max(i,0),(this._bRtlMode||this._keepInWindow())&&(h=Math.min(h,document.documentElement.clientWidth-this._RootWidth)),(!this._bRtlMode||this._keepInWindow())&&(h=Math.max(h,0)),this._keepInWindow()&&(i=Math.min(i,document.documentElement.clientHeight-this._RootHeight)),this.oPopup.setPosition(d.Dock.LeftTop,{left:h,top:i})),a.cancelBubble=!0,!1},e.prototype._keepInWindow=function(){return this.getKeepInWindow()||this.getModal()},e.prototype.handleMouseUp=function(){if(null!==this.sDragMode){a(window.document).unbind("selectstart",this.ondragstart),a(window.document).unbind("mousemove",this.handleMove),a(window.document).unbind("mouseup",this.handleMouseUp);var b=e._findSameDomainParentWinDoc();b&&(a(b).unbind("selectstart",this.ondragstart),a(b).unbind("mousemove",this.handleMove),a(b).unbind("mouseup",this.handleMouseUp)),sap.ui.Device.browser.webkit&&sap.ui.core.RenderManager.forceRepaint(this.getId()),this.restoreFocus(),this.sDragMode=null}},e.setAutoClose=function(a){this.oPopup.setAutoClose(a)},e.getAutoClose=function(){this.oPopup.getAutoClose()},e},!0);