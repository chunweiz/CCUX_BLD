sap.ui.define(["jquery.sap.global","ute/ui/commons/Textfield","sap/ui/model/type/Date","./Calendar"],function(a,b,c,d){"use strict";var e=b.extend("ute.ui.commons.DatePicker",{metadata:{library:"ute.ui.commons",properties:{defaultDate:{type:"string",defaultValue:null}}}});return e.prototype.init=function(){this._oFormatYyyymmdd=sap.ui.core.format.DateFormat.getInstance({pattern:"MM/dd/yyyy",strictParsing:!0}),this._oMinDate=new Date,this._oMinDate.setHours(0,0,0,0),this._oMaxDate=new Date(9999,11,31)},e.prototype.onAfterRendering=function(){},e.prototype.exit=function(){this._oDate=void 0,this._oLocale=void 0,this._oPopup&&(this._oPopup.isOpen()&&this._oPopup.close(),delete this._oPopup),this._oCalendar&&(this._oCalendar.destroy(),delete this._oCalendar)},e.prototype._getLocale=function(){var a=sap.ui.getCore().getConfiguration().getFormatSettings().getFormatLocale();return a},e.prototype._selectDate=function(){var b,c=this._oFormatYyyymmdd.format(this._oCalendar._getFocusedDate());this.focus(),this._oPopup.close(),this.getEditable()&&this.getEnabled()&&c!==this.getValue()&&(this.setProperty("value",c,!0),this.setProperty("defaultDate",c,!0),b=a(this.getInputDomRef()),b.val()!==c&&(b.val(c),this._curpos=c.length,b.cursorPos(this._curpos)))},e.prototype._open=function(){var b,c="";this.getDefaultDate()&&(c=this.getDefaultDate()),c!==this.$("input").val()&&this._checkChange(),this._oPopup||(a.sap.require("sap.ui.core.Popup"),this._oPopup=new sap.ui.core.Popup,this._oPopup.setAutoClose(!0),this._oPopup.setDurations(0,0)),this._oCalendar||(this._oCalendar=new d(this.getId()+"-cal"),this._oCalendar.setSelectedDate(this.getDefaultDate()),this._oCalendar.setMinDate(this._oMinDate),this._oCalendar.setMaxDate(this._oMaxDate),this._oCalendar.attachEvent("select",this._selectDate,this),this._oCalendar.attachEvent("close",this._close,this),this._oPopup.setContent(this._oCalendar),this._oCalendar.setParent(this,void 0,!0)),this._oCalendar.addSelectedDate(this.getDefaultDate()),this._oPopup.setAutoCloseAreas([this.getDomRef()]),b=sap.ui.core.Popup.Dock,this._oPopup.open(0,b.BeginTop,b.BeginBottom,this,null,null,!0)},e.prototype._close=function(){void 0!==this._oPopup&&this._oPopup.isOpen()&&(this._oPopup.close(),this.focus())},e.prototype.onsapshow=function(a){var b=this;this._open(b),a.preventDefault()},e.prototype.onclick=function(b){a(b.target).hasClass("uteDatePicIcon")&&this._open(this)},e.prototype.setDefaultDate=function(b){var c,d=this.getDefaultDate(),e="",f="";return b===d?this:(b?(this._oDate=this._oFormatYyyymmdd.parse(b),(!this._oDate||this._oDate.getTime()<this._oMinDate.getTime()||this._oDate.getTime()>this._oMaxDate.getTime())&&(this._oDate=void 0,a.sap.log.warning("Value can not be converted to a valid date",this))):this._oDate=void 0,this._oDate&&(e=this._oFormatYyyymmdd.format(this._oDate),this.setProperty("defaultDate",b,!0)),this.setProperty("value",e,!0),this.getDomRef()&&(f="",c=a(this.getInputDomRef()),f=e,c.val(f)),this)},e.prototype.onsapfocusleave=function(b){this._oCalendar&&b.relatedControlId&&(a.sap.containsOrEquals(this._oCalendar.getDomRef(),sap.ui.getCore().byId(b.relatedControlId).getFocusDomRef())||this.getId()===b.relatedControlId)||(this._checkChange(b),void 0!==this._oPopup&&this._oPopup.isOpen()&&(this._oPopup.close(),this.focus()),b.preventDefault(),b.stopPropagation())},e.prototype.setMinDate=function(a){this._oMinDate=a,this._oCalendar&&this._oCalendar.setMinDate(this._oMinDate)},e.prototype.setMaxDate=function(a){this._oMaxDate=a,this._oCalendar&&this._oCalendar.setMaxDate(this._oMaxDate)},e.prototype._checkChange=function(){var b=a(this.getInputDomRef()),c=b.val(),d=this.getDefaultDate();d!==c&&""!==c&&(this._oDate=this._oFormatYyyymmdd.parse(c),!this._oDate||this._oDate.getTime()<this._oMinDate.getTime()||this._oDate.getTime()>this._oMaxDate.getTime()?this._oDate=void 0:(c=this._oFormatYyyymmdd.format(this._oDate),b.val(c),this.setProperty("value",c,!0),this.setProperty("defaultDate",c,!0),this.fireChange({newValue:c}),this._oPopup&&this._oPopup.isOpen()&&this._oCalendar.focusDate(this._oDate)))},e},!0);