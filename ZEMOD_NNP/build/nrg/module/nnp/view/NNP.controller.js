sap.ui.define(["nrg/base/view/BaseController","sap/ui/model/Filter","sap/ui/model/FilterOperator","jquery.sap.global","sap/ui/model/json/JSONModel"],function(a){"use strict";var b=a.extend("nrg.module.nnp.view.NNP");return b.prototype.onInit=function(){},b.prototype.onBeforeRendering=function(){var a,b,c,d,e=this.getView().getModel("comp-dashboard"),f=new sap.ui.model.json.JSONModel,g=this,h=new sap.ui.model.json.JSONModel({emailExist:!0});a="/EmailNNPs(PartnerID='"+this._sPartnerID+"',Email='"+this._sEmail+"',EmailConsum='"+this._sEmailConsum+"')",this._OwnerComponent=this.getView().getParent().getParent().getParent().getController().getOwnerComponent(),this.getView().setModel(f,"oEditEmailNNP"),this.getView().setModel(h,"oLocalModel"),this.getView().setModel(new sap.ui.model.json.JSONModel,"oEditEmailValidate"),this._OwnerComponent.getCcuxApp().setOccupied(!0),c=this.getView().byId("idnrgDB-EmailBox"),d=this.getView().byId("idnrgDB-DelEmailBox"),c.setVisible(!0),d.setVisible(!1),b={success:function(a){a&&(this._beforeOpenEditAddrDialogue=!0,f.setData(a),(void 0===f.getProperty("/Email")||""===f.getProperty("/Email")||null===f.getProperty("/Email"))&&this.getView().getModel("oLocalModel").setProperty("/emailExist",!1))}.bind(this),error:function(){g.getView().getParent().close(),ute.ui.main.Popup.Alert({title:"Email edit",message:"NNP Entity Service Error"})}.bind(this)},e&&e.read(a,b)},b.prototype._formatEmailMkt=function(a){return"y"===a||"Y"===a?!0:!1},b.prototype._formatPositiveX=function(a){return"x"===a||"X"===a?!0:!1},b.prototype._formatNegativeX=function(a){return"x"===a||"X"===a?!1:!0},b.prototype._onValidateEmailAddress=function(){var a,b,c,d=this.getView().getModel("oEditEmailValidate"),e=this.getView().getModel("comp-dashboard"),f=this.getView().getModel("oEditEmailNNP"),g=this;return this._OwnerComponent.getCcuxApp().setOccupied(!0),f.refresh(!0),c=f.getProperty("/Email"),void 0===c||""===c||null===c?void ute.ui.main.Popup.Alert({title:"Email address validation",message:"Please enter an email address"}):(b="/EmailVerifys('"+c+"')",a={success:function(a){a&&d.setData(a),g._OwnerComponent.getCcuxApp().setOccupied(!1)}.bind(this),error:function(){ute.ui.main.Popup.Alert({title:"Email address validation",message:"Email Validate Service Error"}),g._OwnerComponent.getCcuxApp().setOccupied(!1)}.bind(this)},void(e&&e.read(b,a)))},b.prototype._onEditEmailSave=function(){var a,b,c=this.getView().getModel("comp-dashboard"),d=this.getView().getModel("oEditEmailNNP").getProperty("/PartnerID"),e=this.getView().getModel("oEditEmailNNP").getProperty("/Email"),f=this.getView().getModel("oEditEmailNNP").getProperty("/EmailConsum"),g=this.getView().getModel("oEditEmailNNP"),h=!0,i=this,j=function(){i.getView().getParent().close(),i._OwnerComponent.getCcuxApp().setOccupied(!1)};this._OwnerComponent.getCcuxApp().setOccupied(!0),h=e===this._sEmail?!1:!0,"000"===f?(a="/EmailNNPs(PartnerID='"+d+"',Email='"+e+"',EmailConsum='')",g.setProperty("/EmailConsum","")):a="/EmailNNPs(PartnerID='"+d+"',Email='"+e+"',EmailConsum='"+f+"')",b={merge:!1,success:function(){ute.ui.main.Popup.Alert(h?{title:"Email save ",message:g.getProperty("/LdapMessage"),callback:j}:{title:"Email save",message:"Marketing Preference Updated Successfully",callback:j})}.bind(this),error:function(){ute.ui.main.Popup.Alert({title:"Email save",message:"Update Failed"}),i._OwnerComponent.getCcuxApp().setOccupied(!1)}.bind(this)},c&&c.update(a,g.oData,b)},b.prototype._onEditEmailDelete=function(){var a,b,c=this.getView().getModel("comp-dashboard"),d=this.getView().getModel("oEditEmailNNP").getProperty("/PartnerID"),e=this.getView().getModel("oEditEmailNNP"),f=this;return this._OwnerComponent.getCcuxApp().setOccupied(!0),a="/EmailNNPs(PartnerID='"+d+"',Email='',EmailConsum='')",b={success:function(){f.getView().getParent().close(),f._OwnerComponent.getCcuxApp().setOccupied(!1)}.bind(this),error:function(){f._OwnerComponent.getCcuxApp().setOccupied(!1),f.getView().getParent().close(),ute.ui.main.Popup.Alert({title:"Email delete",message:"Update Failed"})}.bind(this)},"Y"===e.getProperty("/Ecd")||"Y"===e.getProperty("/Mkt")||"Y"===e.getProperty("/Offer")||"Y"===e.getProperty("/Ee")?(this._OwnerComponent.getCcuxApp().setOccupied(!1),void ute.ui.main.Popup.Alert({title:"Email delete",message:"Cannot delete email when preferences set to YES."})):void(c&&c.remove(a,b))},b.prototype._formatEmailAddressText=function(a){return""===a||void 0===a?"CLICK to ADD":a},b.prototype._onShowDelEmailBox=function(){var a=this.getView().byId("idnrgDB-EmailBox"),b=this.getView().byId("idnrgDB-DelEmailBox"),c=this.getView().getModel("oEditEmailNNP"),d=c.getProperty("/Email"),e=this.getView().getModel("oLocalModel");return void 0!==d&&""!==d&&null!==d||e.getProperty("/emailExist")?"Y"===c.getProperty("/Ecd")||"Y"===c.getProperty("/Mkt")||"Y"===c.getProperty("/Offer")||"Y"===c.getProperty("/Ee")?(this._OwnerComponent.getCcuxApp().setOccupied(!1),void ute.ui.main.Popup.Alert({title:"Email delete",message:"Cannot delete email when preferences set to YES."})):(a.setVisible(!1),void b.setVisible(!0)):void ute.ui.main.Popup.Alert({title:"Email address validation",message:"No Email to delete"})},b.prototype._onEmailCancel=function(){var a,b,c=this.getView().byId("idnrgDB-EmailBox"),d=this.getView().byId("idnrgDB-DelEmailBox"),e=this.getView().getModel("comp-dashboard"),f=this._sPartnerID,g=this._sEmail,h=this._sEmailConsum,i=this,j=this.getView().getModel("oEditEmailNNP");this._OwnerComponent.getCcuxApp().setOccupied(!0),a="/EmailNNPs(PartnerID='"+f+"',Email='"+g+"',EmailConsum='"+h+"')",b={success:function(a){a&&(j.setData(a),(void 0===j.getProperty("/Email")||""===j.getProperty("/Email")||null===j.getProperty("/Email"))&&this.getView().getModel("oLocalModel").setProperty("/emailExist",!1),i._OwnerComponent.getCcuxApp().setOccupied(!1))}.bind(this),error:function(){ute.ui.main.Popup.Alert({title:"Email cancel",message:"NNP Entity Service Error"}),i._OwnerComponent.getCcuxApp().setOccupied(!1)}.bind(this)},e&&e.read(a,b),c.setVisible(!0),d.setVisible(!1)},b.prototype._onMktPrefTogg=function(a){var b=this.getView().getModel("oEditEmailNNP");a.mParameters.id.indexOf("ctaddr")>0?a.getSource().getLeftSelected()?b.setProperty("/Ecd","Y"):b.setProperty("/Ecd","N"):a.mParameters.id.indexOf("rpdsrv")>0?a.getSource().getLeftSelected()?b.setProperty("/Mkt","Y"):b.setProperty("/Mkt","N"):a.mParameters.id.indexOf("thrdpty")>0?a.getSource().getLeftSelected()?b.setProperty("/Offer","Y"):b.setProperty("/Offer","N"):a.getSource().getLeftSelected()?b.setProperty("/Ee","Y"):b.setProperty("/Ee","N")},b.prototype.onPopupClose=function(){this.getView().getParent().close()},b});