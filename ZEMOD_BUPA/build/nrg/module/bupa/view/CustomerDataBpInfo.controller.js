sap.ui.define(["jquery.sap.global","nrg/base/view/BaseController","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/ui/core/routing/HashChanger","sap/ui/core/format/DateFormat","sap/ui/core/message/Message","sap/ui/core/message/ControlMessageProcessor","nrg/module/nnp/view/NNPPopup","nrg/base/type/CellPhoneNumber","nrg/base/type/EmailAddress","nrg/base/type/SocialSecurityNumber","nrg/base/type/DrivingLicenseNumber","nrg/base/type/ZipCode"],function(a,b,c,d,e,f,g,h,i){"use strict";var j=b.extend("nrg.module.bupa.view.CustomerDataBpInfo");return b.prototype.onBeforeRendering=function(){this.getOwnerComponent().getCcuxApp().setTitle("BUSINESS PARTNER"),this.getView().setModel(this.getOwnerComponent().getModel("comp-bupa"),"oODataSvc"),this.getView().setModel(this.getOwnerComponent().getModel("comp-dropdown"),"oODataDropdownSvc"),this.getView().setModel(new sap.ui.model.json.JSONModel,"oBpInfoConfig"),this.getView().setModel(new sap.ui.model.json.JSONModel,"oDataBP"),this.getView().setModel(new sap.ui.model.json.JSONModel,"oDataBpName"),this.getView().setModel(new sap.ui.model.json.JSONModel,"oDataBpAddress"),this.getView().setModel(new sap.ui.model.json.JSONModel,"oDataBpPersonal"),this.getView().setModel(new sap.ui.model.json.JSONModel,"oDataBpContact"),this.getView().setModel(new sap.ui.model.json.JSONModel,"oDataBpMarkPreferSet"),this.getView().setModel(new sap.ui.model.json.JSONModel,"oDataBpTitles"),this.getView().setModel(new sap.ui.model.json.JSONModel,"ODataBpAccTitles"),this.getView().setModel(new sap.ui.model.json.JSONModel,"ODataBpSuffixs"),this.getView().setModel(new sap.ui.model.json.JSONModel,"oDataBpLegalForms"),this.getView().setModel(new sap.ui.model.json.JSONModel,"oDayPhoneType"),this.getView().setModel(new sap.ui.model.json.JSONModel,"oEvnPhoneType"),this._initPhnTypes(),a(document).on("keydown",function(b){8!==b.which||a(b.target).is("input, textarea")||b.preventDefault()}),this.getView().setModel(new sap.ui.model.json.JSONModel,"oEditEmailNNP"),this.getView().setModel(new sap.ui.model.json.JSONModel,"oEditEmailValidate"),this.getView().setModel(new sap.ui.model.json.JSONModel,"oDataAddrEdit"),this.getView().attachParseError(function(a){this._addMessage(a,"attachParseError: "+a.getParameter("message"),sap.ui.core.MessageType.Error)}.bind(this)),this.getView().attachFormatError(function(a){this._addMessage(a,"attachFormatError: "+a.getParameter("message"),sap.ui.core.MessageType.Error)}.bind(this)),this.getView().attachValidationError(function(a){this._addMessage(a,"attachValidationError: "+a.getParameter("message"),sap.ui.core.MessageType.Error)}.bind(this)),this.getView().attachValidationSuccess(function(b){var c,d;c=sap.ui.getCore().getMessageManager(),d=c.getMessageModel().getData(),d&&!a.isEmptyObject(d)&&d.forEach(function(a){a.target===[b.getParameter("id"),b.getParameter("property")].join("/")&&c.removeMessages(a)}.bind(this))})},j.prototype.onAfterRendering=function(){var a=this.getOwnerComponent().getCcuxRouteManager().getCurrentRouteInfo();this._bpNum=a.parameters.bpNum,this._caNum=a.parameters.caNum,this._coNum=a.parameters.coNum,this._initBPData(),this._initBpConfig()},j.prototype.onExit=function(){return void 0},j.prototype._initBPData=function(){this.getView().getModel("oDataBP").setProperty("/PartnerID",!0),this._retrBpTitles(this._bpNum),this._retrBpAccTitles(),this._retrBpSuffixs(),this._retrBpAddress(this._bpNum),this._retrBpLegalForm(),this._retrBpContact(this._bpNum),this._retrBpMarkPrefSet(this._bpNum)},b.prototype._retrBpTitles=function(a){var b,c=this.getView().getModel("oODataSvc"),d="/Partners('"+a+"')/BpTitle/";b={success:function(a){if(a.results){var b=JSON.parse(JSON.stringify(a.results[0]));b.Key="0000",b.Partner="",b.PartnerID="",b.Value="",a.results.unshift(b),this.getView().getModel("oDataBpTitles").setData(a)}}.bind(this),error:function(){}.bind(this)},c&&c.read(d,b)},b.prototype._retrBpAccTitles=function(){var a,b=this.getView().getModel("oODataSvc"),c="/BpAccTitles/";a={success:function(a){if(a.results){var b=JSON.parse(JSON.stringify(a.results[0]));b.Key="0000",b.Partner="",b.PartnerID="",b.Value="",a.results.unshift(b),this.getView().getModel("ODataBpAccTitles").setData(a)}}.bind(this),error:function(){}.bind(this)},b&&b.read(c,a)},b.prototype._retrBpSuffixs=function(){var a,b=this.getView().getModel("oODataSvc"),c="/BpSuffixs/";a={success:function(a){if(a.results){var b=JSON.parse(JSON.stringify(a.results[0]));b.Key="0000",b.Partner="",b.PartnerID="",b.Value="",a.results.unshift(b),this.getView().getModel("ODataBpSuffixs").setData(a),this._retrBpName(this._bpNum)}}.bind(this),error:function(){}.bind(this)},b&&b.read(c,a)},b.prototype._retrBpName=function(b){var c,d=this.getView().getModel("oODataSvc"),e="/Partners('"+b+"')/BpName/";c={success:function(b){b.PartnerID&&(""===b.Title&&(b.Title="0000"),""===b.AcademicTitle&&(b.AcademicTitle="0000"),""===b.Suffix&&(b.Suffix="0000"),this.getView().getModel("oDataBpName").setData(b),this.oDataBpNameBak=a.extend(!0,{},b),"1"===b.PartnerType?(this.getView().getModel("oDataBP").setProperty("/OrgBP",!1),this.getView().getModel("oDataBP").setProperty("/PsnBP",!0)):(this.getView().getModel("oDataBP").setProperty("/OrgBP",!0),this.getView().getModel("oDataBP").setProperty("/PsnBP",!1)))}.bind(this),error:function(){}.bind(this)},d&&d.read(e,c)},b.prototype._retrBpAddress=function(b){var c,d=this.getView().getModel("oODataSvc"),e="/Partners('"+b+"')/BpAddress/";c={success:function(b){b&&b.results[0]&&(this._addressID||(this._addressID=b.results[0].AddressID),this.getView().getModel("oDataBpAddress").setData(b.results[0]),this.getView().getModel("oDataAddrEdit").setData(b.results[0]),this.oDataBpAddressBak=a.extend(!0,{},b))}.bind(this),error:function(){}.bind(this)},d&&d.read(e,c)},b.prototype._retrBpLegalForm=function(){var a,b=this.getView().getModel("oODataDropdownSvc"),c="/LegalFormS";a={success:function(a){a&&(this.getView().getModel("oDataBpLegalForms").setData(a),this._retrBpPersonal(this._bpNum))}.bind(this),error:function(){}.bind(this)},b&&b.read(c,a)},b.prototype._retrBpPersonal=function(b){var c,d=this.getView().getModel("oODataSvc"),e="/Partners('"+b+"')/BpPersonal/";c={success:function(b){b.PartnerID&&(this.getView().getModel("oDataBpPersonal").setData(b),this.oDataBpPersonalBak=a.extend(!0,{},b))}.bind(this),error:function(){}.bind(this)},d&&d.read(e,c)},b.prototype._retrBpContact=function(b){var c,d=this.getView().getModel("oODataSvc"),e="/Partners('"+b+"')/BpContact/";c={success:function(b){b.PartnerID&&(this.getView().getModel("oDataBpContact").setData(b),this.oDataBpContactBak=a.extend(!0,{},b))}.bind(this),error:function(){}.bind(this)},d&&d.read(e,c)},b.prototype._retrBpMarkPrefSet=function(b){var c,d=this.getView().getModel("oODataSvc"),e="/Partners('"+b+"')/BpMarkPreferSet/";c={success:function(b){b.results&&(this.getView().getModel("oDataBpMarkPreferSet").setData(b),this.oDataBpMarkPreferSetBak=a.extend(!0,{},b))}.bind(this),error:function(){}.bind(this)},d&&d.read(e,c)},j.prototype._initBpConfig=function(){var a=this.getView().getModel("oBpInfoConfig");a.setProperty("/titleEditVisible",!0),a.setProperty("/titleSaveVisible",!1),a.setProperty("/titleEditable",!1),a.setProperty("/addrEditVisible",!0),a.setProperty("/addrSaveVisible",!1),a.setProperty("/addrEditable",!1),a.setProperty("/personalInfoEditVisible",!0),a.setProperty("/personalInfoSaveVisible",!1),a.setProperty("/personalInfoSSEditable",!1),a.setProperty("/personalInfoDLEditable",!1),a.setProperty("/personalInfoEditable",!1),a.setProperty("/dnpEditVisible",!0),a.setProperty("/dnpSaveVisible",!1),a.setProperty("/dnpEditable",!1),a.setProperty("/contactInfoEditVisible",!0),a.setProperty("/contactInfoSaveVisible",!1),a.setProperty("/contactInfoEditable",!1),a.setProperty("/marketPrefEditVisible",!0),a.setProperty("/marketPrefSaveVisible",!1),a.setProperty("/mktPrfEditable",!1)},j.prototype.onTitleEdit=function(){var a=this.getView().getModel("oBpInfoConfig");a.setProperty("/titleEditVisible",!1),a.setProperty("/titleSaveVisible",!0),a.setProperty("/titleEditable",!0)},j.prototype.onTitleSave=function(){var b,c=this.getView().getModel("oBpInfoConfig"),d=this.getView().getModel("oDataBpName"),e=this.getView().getModel("oODataSvc"),f="/BpNames('"+this._bpNum+"')";return this.getOwnerComponent().getCcuxApp().setOccupied(!0),c.setProperty("/titleEditVisible",!0),c.setProperty("/titleSaveVisible",!1),c.setProperty("/titleEditable",!1),JSON.stringify(d.oData)===JSON.stringify(this.oDataBpNameBak)?void sap.ui.commons.MessageBox.alert("There is no change for Title/Name."):("0000"===d.oData.Title&&(d.oData.Title=""),"0000"===d.oData.AcademicTitle&&(d.oData.AcademicTitle=""),"0000"===d.oData.Suffix&&(d.oData.Suffix=""),b={merge:!1,success:function(){sap.ui.commons.MessageBox.alert("Title/Name Update Success"),this._retrBpName(this._bpNum),this.getOwnerComponent().getCcuxApp().setOccupied(!1)}.bind(this),error:function(){sap.ui.commons.MessageBox.alert("Title/Name Update Failed"),d.setData(a.extend(!0,{},this.oDataBpNameBak)),this.getOwnerComponent().getCcuxApp().setOccupied(!1)}.bind(this)},void(e&&e.update(f,d.oData,b)))},j.prototype.onTitleCancel=function(){var b=this.getView().getModel("oBpInfoConfig"),c=this.getView().getModel("oDataBpName");b.setProperty("/titleEditVisible",!0),b.setProperty("/titleSaveVisible",!1),b.setProperty("/titleEditable",!1),""===this.oDataBpNameBak.Title&&(this.oDataBpNameBak.Title="0000"),""===this.oDataBpNameBak.AcademicTitle&&(this.oDataBpNameBak.AcademicTitle="0000"),""===this.oDataBpNameBak.Suffix&&(this.oDataBpNameBak.Suffix="0000"),c.setData(a.extend(!0,{},this.oDataBpNameBak))},j.prototype.onAddrEdit=function(){var a=this.getView().getModel("oBpInfoConfig");a.setProperty("/addrEditVisible",!1),a.setProperty("/addrSaveVisible",!0),a.setProperty("/addrEditable",!0)},j.prototype.onAddrSave=function(){var a,b,c=this.getView().getModel("oBpInfoConfig"),d=this.getView().getModel("oDataAddrEdit"),e=this.getView().getModel("oDataBpAddress"),f=this.getView().getModel("oODataSvc"),g="/BpAddresses",h=this._createAddrValidateFilters();return c.setProperty("/addrEditVisible",!0),c.setProperty("/addrSaveVisible",!1),c.setProperty("/addrEditable",!1),JSON.stringify(e.oData)===JSON.stringify(this.oDataBpAddressBak.results[0])?void sap.ui.commons.MessageBox.alert("There is no change for Address."):(d.setProperty("/",e.getProperty("/")),a={filters:h,success:function(a){"X"===a.AddrChkValid?(b=e.getProperty("/"),delete b.showVldBtns,delete b.updateNotSent,delete b.updateSent,delete b.SuggAddrInfo,this._updateMailingAddr()):(this._oMailEditPopup||(this._oMailEditPopup=ute.ui.main.Popup.create({close:this._handleEditMailPopupClose,content:sap.ui.xmlfragment(this.getView().sId,"nrg.module.bupa.view.AddrUpdatePopup",this),title:"Edit Mailing Address"}),this.getView().addDependent(this._oMailEditPopup)),this._oMailEditPopup.open(),this._showSuggestedAddr(),d.setProperty("/SuggAddrInfo",a.results[0].TriCheck))}.bind(this),error:function(){sap.ui.commons.MessageBox.alert("Validatation Call Failed")}.bind(this)},void(f&&f.read(g,a)))},j.prototype.onAddrCancel=function(){var b=this.getView().getModel("oBpInfoConfig"),c=this.getView().getModel("oDataBpAddress");b.setProperty("/addrEditVisible",!0),b.setProperty("/addrSaveVisible",!1),b.setProperty("/addrEditable",!1),c.setData(a.extend(!0,{},this.oDataBpAddressBak))},j.prototype.onPersonalInfoEdit=function(){var a=this.getView().getModel("oBpInfoConfig"),b=this.getView().getModel("oDataBpPersonal");a.setProperty("/personalInfoEditVisible",!1),a.setProperty("/personalInfoSaveVisible",!0),a.setProperty("/personalInfoEditable",!0),""===b.getData().SSN&&a.setProperty("/personalInfoSSEditable",!0),""===b.getData().DL&&a.setProperty("/personalInfoDLEditable",!0)},j.prototype.onPersonalInfoSave=function(){var a,b,c=this.getView().getModel("oBpInfoConfig"),d=this.getView().getModel("oODataSvc"),e=this.getView().getModel("oDataBpPersonal"),f=this._bpNum;return c.setProperty("/personalInfoEditVisible",!0),c.setProperty("/personalInfoSaveVisible",!1),c.setProperty("/personalInfoSSEditable",!1),c.setProperty("/personalInfoDLEditable",!1),c.setProperty("/personalInfoEditable",!1),JSON.stringify(e.oData)===JSON.stringify(this.oDataBpPersonalBak)?void sap.ui.commons.MessageBox.alert("There is no change for Personal Info."):(e.oData.SSN!==this.oDataBpPersonalBak.SSN&&(e.oData.SSNUpd="X"),e.oData.DL!==this.oDataBpPersonalBak.DL&&(e.oData.DLUpd="X"),e.oData.PIN!==this.oDataBpPersonalBak.PIN&&(e.oData.PINUpd="X"),e.oData.TaxID!==this.oDataBpPersonalBak.TaxID&&(e.oData.TaxIDUpd="X"),a="/BpPersonals('"+f+"')",b={merge:!1,success:function(){sap.ui.commons.MessageBox.alert("Personal Info Update Success"),this._retrBpPersonal(f)}.bind(this),error:function(){sap.ui.commons.MessageBox.alert("Personal Info Update Failed")}.bind(this)},void(d&&d.update(a,this.getView().getModel("oDataBpPersonal").oData,b)))},j.prototype.onPersonalInfoCancel=function(){var b=this.getView().getModel("oBpInfoConfig"),c=this.getView().getModel("oDataBpPersonal");b.setProperty("/personalInfoEditVisible",!0),b.setProperty("/personalInfoSaveVisible",!1),b.setProperty("/personalInfoSSEditable",!1),b.setProperty("/personalInfoDLEditable",!1),b.setProperty("/personalInfoEditable",!1),c.setData(a.extend(!0,{},this.oDataBpPersonalBak))},j.prototype.onContactInfoEdit=function(){var a=this.getView().getModel("oBpInfoConfig");a.setProperty("/contactInfoEditVisible",!1),a.setProperty("/contactInfoSaveVisible",!0),a.setProperty("/contactInfoEditable",!0)},j.prototype.onContactInfoSave=function(){var a,b,c=this.getView().getModel("oBpInfoConfig"),d=this.getView().getModel("oODataSvc"),e=this._bpNum;return c.setProperty("/contactInfoEditVisible",!0),c.setProperty("/contactInfoSaveVisible",!1),c.setProperty("/contactInfoEditable",!1),JSON.stringify(this.getView().getModel("oDataBpContact").oData)===JSON.stringify(this.oDataBpContactBak)?void sap.ui.commons.MessageBox.alert("There is no change for Contact Info."):(a="/BpContacts('"+e+"')",b={merge:!1,success:function(){sap.ui.commons.MessageBox.alert("Contact Info Update Success"),this._retrBpContact(e)}.bind(this),error:function(){sap.ui.commons.MessageBox.alert("Contact Info Update Failed")}.bind(this)},void(d&&d.update(a,this.getView().getModel("oDataBpContact").oData,b)))},j.prototype.onContactInfoCancel=function(){var b=this.getView().getModel("oBpInfoConfig"),c=this.getView().getModel("oDataBpContact");b.setProperty("/contactInfoEditVisible",!0),b.setProperty("/contactInfoSaveVisible",!1),b.setProperty("/contactInfoEditable",!1),c.setData(a.extend(!0,{},this.oDataBpContactBak))},j.prototype.onMarketPrefEdit=function(){var a=this.getView().getModel("oBpInfoConfig");a.setProperty("/marketPrefEditVisible",!1),a.setProperty("/marketPrefSaveVisible",!0),a.setProperty("/mktPrfEditable",!0)},j.prototype.onMarketPrefSave=function(){var a,b,c,d,e=this.getView().getModel("oBpInfoConfig"),f=(this.getView().getModel("oODataSvc"),this._bpNum),g=[];for(e.setProperty("/marketPrefEditVisible",!0),e.setProperty("/marketPrefSaveVisible",!1),e.setProperty("/mktPrfEditable",!1),c=0;c<this.getView().getModel("oDataBpMarkPreferSet").oData.results.length;c+=1)JSON.stringify(this.getView().getModel("oDataBpMarkPreferSet").oData.results[c])!==JSON.stringify(this.oDataBpMarkPreferSetBak.results[c])&&(a=this.getView().getModel("oDataBpMarkPreferSet").getProperty("/results/"+c.toString()+"/AttributeSet"),b=this.getView().getModel("oDataBpMarkPreferSet").getProperty("/results/"+c.toString()+"/Attribute"),d={},d.iIndex=c,d.sPath="/BpMarkPrefers(PartnerID='"+f+"',AttributeSet='"+a+"',Attribute='"+b+"')",g.push(d));g.length>0&&this._updateSingleMarketPref(g,0)},j.prototype.onMarketPrefCancel=function(){var b=this.getView().getModel("oBpInfoConfig"),c=this.getView().getModel("oDataBpMarkPreferSet");b.setProperty("/marketPrefEditVisible",!0),b.setProperty("/marketPrefSaveVisible",!1),b.setProperty("/mktPrfEditable",!1),c.setData(a.extend(!0,{},this.oDataBpMarkPreferSetBak))},j.prototype._getMessageProcessor=function(){return this._oControlMessageProcessor||(this._oControlMessageProcessor=new h),this._oControlMessageProcessor},j.prototype._addMessage=function(a,b,c){var d=new g({message:b,type:c,target:[a.getParameter("id"),a.getParameter("property")].join("/"),processor:this._getMessageProcessor()});sap.ui.getCore().getMessageManager().addMessages(d)},j.prototype.onBackToDashboard=function(){var a=this.getOwnerComponent().getRouter();this._coNum?a.navTo("dashboard.VerificationWithCaCo",{bpNum:this._bpNum,caNum:this._caNum,coNum:this._coNum}):this._caNum?a.navTo("dashboard.VerificationWithCa",{bpNum:this._bpNum,caNum:this._caNum}):a.navTo("dashboard.Verification",{bpNum:this._bpNum})},b.prototype._handleMailingAddrUpdate=function(){this.onAddrSave()},b.prototype._updateSingleMarketPref=function(a,b){var c,d=this.getView().getModel("oODataSvc"),e=this._bpNum,f={};c={merge:!1,success:function(){b<a.length-1?this._updateSingleMarketPref(a,b+1):(this._retrBpMarkPrefSet(e),sap.ui.commons.MessageBox.alert("Market Preference Update Success"))}.bind(this),error:function(){sap.ui.commons.MessageBox.alert("Market Preference Update Failed")}.bind(this)},f=this.getView().getModel("oDataBpMarkPreferSet").oData.results[a[b].iIndex],delete f.Partner,delete f.__metadata,d&&d.update(a[b].sPath,f,c)},b.prototype._retrUrlHash=function(){var a=new e,b=a.getHash();return b},b.prototype._initPhnTypes=function(){var a=this.getView().getModel("oDayPhoneType"),b=this.getView().getModel("oEvnPhoneType"),c=[],d=[];c=[{Key:"WORK",Type:"LANDLINE"},{Key:"CELL",Type:"CELL"}],d=[{Key:"HOME",Type:"LANDLINE"},{Key:"CELL",Type:"CELL"}],a.setProperty("/",c),b.setProperty("/",d)},b.prototype.onYesSelected=function(a){var b,c,d,e;b=a.getSource().oPropagatedProperties.oBindingContexts.oDataBpMarkPreferSet.sPath,c=parseInt(b.split("/")[2],10),d=this.getView().getModel("oDataBpMarkPreferSet"),e=d.getData(),e.results[c].Value="Y"===e.results[c].Value?"":"Y",d.setData(e)},b.prototype.onNoSelected=function(a){var b,c,d,e;b=a.getSource().oPropagatedProperties.oBindingContexts.oDataBpMarkPreferSet.sPath,c=parseInt(b.split("/")[2],10),d=this.getView().getModel("oDataBpMarkPreferSet"),e=d.getData(),e.results[c].Value="N"===e.results[c].Value?"":"N",d.setData(e)},b.prototype._showSuggestedAddr=function(){this.getView().getModel("oDataAddrEdit").setProperty("/updateSent",!0),this.getView().getModel("oDataAddrEdit").setProperty("/showVldBtns",!0),this.getView().getModel("oDataAddrEdit").setProperty("/updateNotSent",!1)},b.prototype._createAddrValidateFilters=function(){var a,b,e,f=[],g=this._bpNum,h=this.getView().getModel("oDataAddrEdit"),i=h.getProperty("/AddressInfo");a=new c({path:"PartnerID",operator:d.EQ,value1:g}),f.push(a),a=new c({path:"ChkAddr",operator:d.EQ,value1:"X"}),f.push(a);for(b in i)i.hasOwnProperty(b)&&"__metadata"!==b&&"StandardFlag"!==b&&"ShortForm"!==b&&"ValidFrom"!==b&&"ValidTo"!==b&&"Supplement"!==b&&(e="AddressInfo/"+b,a=new c({path:e,operator:d.EQ,value1:i[b]}),f.push(a));return f},b.prototype._updateMailingAddr=function(){var a,b,c=this.getView().getModel("oODataSvc"),d=this._bpNum,e=this._addressID;a="/BpAddresses(PartnerID='"+d+"',AddressID='"+e+"')",b={urlParameters:{},success:function(){sap.ui.commons.MessageBox.alert("Address Update Success"),this._retrBpAddress(d),this._oMailEditPopup.close()}.bind(this),error:function(){sap.ui.commons.MessageBox.alert("Address Update Failed")}.bind(this)},c&&c.update(a,this.getView().getModel("oDataBpAddress").oData,b)},b.prototype._onPoBoxEdit=function(){this.getView().byId("idEditHouseNum").setValue(""),this.getView().byId("idEditStName").setValue("")},b.prototype._onBpInfoPoBoxEdit=function(){this.getView().byId("idBpInfoStreet_Edit").setValue(""),this.getView().byId("idBpInfoHouseNo_Edit").setValue("")},b.prototype._onRegAddrEdit=function(){this.getView().byId("idEditPoBox").setValue("")},b.prototype._onBpInfoRegAddrEdit=function(){this.getView().byId("idBpInfoPobox_Edit").setValue("")},b.prototype._compareSuggChkClicked=function(a){var b,c=this._oMailEditPopup.getContent()[0].getContent()[1].getContent(),d=this._oMailEditPopup.getContent()[0].getContent()[2].getContent();if(a.mParameters.checked)for(b=1;8>b;b+=1)c[b].getContent()[0].getValue()!==d[b].getContent()[0].getValue()&&(c[b].getContent()[0].addStyleClass("nrgBupa-cusDataVerifyEditMail-lHighlight"),d[b].getContent()[0].addStyleClass("nrgBupa-cusDataVerifyEditMail-rHighlight"));else for(b=1;8>b;b+=1)c[b].getContent()[0].getValue()!==d[b].getContent()[0].getValue()&&(c[b].getContent()[0].removeStyleClass("nrgBupa-cusDataVerifyEditMail-lHighlight"),d[b].getContent()[0].removeStyleClass("nrgBupa-cusDataVerifyEditMail-rHighlight"))},b.prototype._handleMailingAcceptBtn=function(){var a,b,c,d=this.getView().getModel("oDataAddrEdit"),e=this.getView().getModel("oDataBpAddress");a=d.getProperty("/SuggAddrInfo"),delete a.HeaderText1,delete a.HeaderText2,delete a.FooterLine1,delete a.FooterLine2,delete a.FooterLine3,b=e.getProperty("/"),delete b.showVldBtns,delete b.updateNotSent,delete b.updateSent,delete b.SuggAddrInfo;for(c in a)a.hasOwnProperty(c)&&"__metadata"!==c&&"StandardFlag"!==c&&"Supplement"!==c&&e.setProperty("/AddressInfo/"+c,a[c]);this._updateMailingAddr()},b.prototype._handleMailingDeclineBtn=function(){var a,b,c=this.getView().getModel("oDataAddrEdit"),d=this.getView().getModel("oDataBpAddress");a=c.getProperty("/AddressInfo"),b=d.getProperty("/"),delete b.showVldBtns,delete b.updateNotSent,delete b.updateSent,delete b.SuggAddrInfo,d.setProperty("/AddressInfo",a),this._updateMailingAddr()},b.prototype._handleMailingEditBtn=function(){var a=this.getView().getModel("oDataAddrEdit");a.setProperty("/showVldBtns",!1),a.setProperty("/updateNotSent",!0)},b.prototype._formatLanguage=function(a){return"E"===a||"e"===a?"EN":"S"===a||"s"===a?"SP":"N/A"},b.prototype._formatDate=function(a){if(a){var b=f.getInstance({pattern:"MM/dd/yyyy"});return b.format(a)}},b.prototype._formatBooleanY=function(a){return"Y"===a?!0:!1},b.prototype._formatBooleanN=function(a){return"N"===a?!0:!1},b.prototype._formatGreenCheck=function(a){return"x"===a||"X"===a?!0:!1},b.prototype._formatRedX=function(a,b){return b?"x"===a||"X"===a?!1:!0:!1},b.prototype._formatEmailAddressText=function(a){return""===a||void 0===a?" ":a},b.prototype._formatEmailMkt=function(a){return"y"===a||"Y"===a?!0:!1},b.prototype._formatPositiveX=function(a){return"x"===a||"X"===a?!0:!1},b.prototype._formatNegativeX=function(a){return"x"===a||"X"===a?!1:!0},b.prototype._handleNnpClose=function(){var a=this._bpNum,b=this.getView().getModel("oBpInfoConfig");this._retrBpContact(a),b.setProperty("/contactInfoEditVisible",!0),b.setProperty("/contactInfoSaveVisible",!1),b.setProperty("/contactInfoEditable",!1),this.getOwnerComponent().getCcuxApp().setOccupied(!1),this._retrBpMarkPrefSet(a),this.getOwnerComponent().getCcuxApp().setOccupied(!1)},b.prototype._handleEmailEdit=function(){var a=this._bpNum,b=this.getView().getModel("oDataBpContact").getProperty("/Email"),c=this.getView().getModel("oDataBpContact").getProperty("/EmailConsum"),d=new i;d.attachEvent("NNPCompleted",this._handleNnpClose,this),this.getView().addDependent(d),d.openNNP(a,b,c)},b.prototype._onValidateEmailAddress=function(){var a,b,c=this.getView().getModel("oEditEmailValidate"),d=this.getView().getModel("oODataSvc"),e=this.getView().getModel("oEditEmailNNP").getProperty("/Email");this.getOwnerComponent().getCcuxApp().setOccupied(!0),b="/EmailVerifys('"+e+"')",a={success:function(a){a&&(c.setData(a),this.getOwnerComponent().getCcuxApp().setOccupied(!1))}.bind(this),error:function(){sap.ui.commons.MessageBox.alert("Email Validate Service Error"),this.getOwnerComponent().getCcuxApp().setOccupied(!1)}.bind(this)},d&&d.read(b,a)},b.prototype._onEditEmailSave=function(){var a,b,c=this.getView().getModel("oODataSvc"),d=this.getView().getModel("oEditEmailNNP").getProperty("/PartnerID"),e=this.getView().getModel("oEditEmailNNP").getProperty("/Email"),f=this.getView().getModel("oEditEmailNNP").getProperty("/EmailConsum"),g=this.getView().getModel("oEditEmailNNP"),h=!0,i=this.getView().getModel("oBpInfoConfig");this.getOwnerComponent().getCcuxApp().setOccupied(!0),h=e===this.getView().getModel("oDataBpContact").getProperty("/Email")?!1:!0,"000"===f?(a="/EmailNNPs(PartnerID='"+d+"',Email='"+e+"',EmailConsum='')",g.setProperty("/EmailConsum","")):a="/EmailNNPs(PartnerID='"+d+"',Email='"+e+"',EmailConsum='"+f+"')",b={merge:!1,success:function(){sap.ui.commons.MessageBox.alert(h?g.getProperty("/LdapMessage"):"Marketing Preference Updated Successfully"),this._oEmailEditPopup.close(),this._retrBpContact(d),i.setProperty("/contactInfoEditVisible",!0),i.setProperty("/contactInfoSaveVisible",!1),i.setProperty("/contactInfoEditable",!1),this.getOwnerComponent().getCcuxApp().setOccupied(!1),this._retrBpMarkPrefSet(d)}.bind(this),error:function(){sap.ui.commons.MessageBox.alert("Update Failed"),this.getOwnerComponent().getCcuxApp().setOccupied(!1)}.bind(this)},c&&c.update(a,g.oData,b)},b.prototype._onEditEmailDelete=function(){var a,b,c=this.getView().getModel("oODataSvc"),d=this.getView().getModel("oEditEmailNNP").getProperty("/PartnerID"),e=this.getView().getModel("oEditEmailNNP"),f=this.getView().getModel("oBpInfoConfig");return a="/EmailNNPs(PartnerID='"+d+"',Email='',EmailConsum='')",this.getOwnerComponent().getCcuxApp().setOccupied(!0),b={success:function(){this._oEmailEditPopup.close(),this._retrBpContact(d),this._retrBpMarkPrefSet(d),f.setProperty("/contactInfoEditVisible",!0),f.setProperty("/contactInfoSaveVisible",!1),f.setProperty("/contactInfoEditable",!1),this.getOwnerComponent().getCcuxApp().setOccupied(!1)}.bind(this),error:function(){sap.ui.commons.MessageBox.alert("Update Failed"),this.getOwnerComponent().getCcuxApp().setOccupied(!1),this._oEmailEditPopup.close()}.bind(this)},"Y"===e.getProperty("/Ecd")||"Y"===e.getProperty("/Mkt")||"Y"===e.getProperty("/Offer")||"Y"===e.getProperty("/Ee")?(this.getOwnerComponent().getCcuxApp().setOccupied(!1),void sap.ui.commons.MessageBox.alert("Cannot delete email when preferences set to YES.")):void(c&&c.remove(a,b))},b.prototype._onMktPrefTogg=function(a){var b=this.getView().getModel("oEditEmailNNP");a.mParameters.id.indexOf("ctaddr")>0?a.getSource().getLeftSelected()?b.setProperty("/Ecd","Y"):b.setProperty("/Ecd","N"):a.mParameters.id.indexOf("rpdsrv")>0?a.getSource().getLeftSelected()?b.setProperty("/Mkt","Y"):b.setProperty("/Mkt","N"):a.mParameters.id.indexOf("thrdpty")>0?a.getSource().getLeftSelected()?b.setProperty("/Offer","Y"):b.setProperty("/Offer","N"):a.getSource().getLeftSelected()?b.setProperty("/Ee","Y"):b.setProperty("/Ee","N")},b.prototype._onShowDelEmailBox=function(){var a=sap.ui.core.Fragment.byId(this.getView().sId,"idnrgDB-EmailBox"),b=sap.ui.core.Fragment.byId(this.getView().sId,"idnrgDB-DelEmailBox"),c=this.getView().getModel("oEditEmailNNP");return"Y"===c.getProperty("/Ecd")||"Y"===c.getProperty("/Mkt")||"Y"===c.getProperty("/Offer")||"Y"===c.getProperty("/Ee")?(this.getOwnerComponent().getCcuxApp().setOccupied(!1),void sap.ui.commons.MessageBox.alert("Cannot delete email when preferences set to YES.")):(a.setVisible(!1),void b.setVisible(!0))},b.prototype._onEmailCancel=function(){var a,b,c=sap.ui.core.Fragment.byId(this.getView().sId,"idnrgDB-EmailBox"),d=sap.ui.core.Fragment.byId(this.getView().sId,"idnrgDB-DelEmailBox"),e=this.getView().getModel("oODataSvc"),f=this.getView().getModel("oEditEmailNNP").getProperty("/PartnerID"),g=this.getView().getModel("oDataBpContact").getProperty("/Email"),h=this.getView().getModel("oDataBpContact").getProperty("/EmailConsum");this.getOwnerComponent().getCcuxApp().setOccupied(!0),a="/EmailNNPs(PartnerID='"+f+"',Email='"+g+"',EmailConsum='"+h+"')",b={success:function(a){a&&(this.getView().getModel("oEditEmailNNP").setData(a),this.getOwnerComponent().getCcuxApp().setOccupied(!1))}.bind(this),error:function(){sap.ui.commons.MessageBox.alert("NNP Entity Service Error"),this.getOwnerComponent().getCcuxApp().setOccupied(!1)}.bind(this)},e&&e.read(a,b),c.setVisible(!0),d.setVisible(!1)},j});